<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº²å­æ€§æ ¼åŒ¹é…åˆ†æ - å’Œäº‹å®</title>
    <script src="personality_questions.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #f5f7fa;
            --text-color: #2c3e50;
            --border-radius: 15px;
            --shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: SimSun, 'å®‹ä½“', serif;
            background: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .test-header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease;
        }

        .test-header h1 {
            font-size: 2rem;
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .test-header p {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 2rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
            width: 0%;
        }

        .question-container {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .option.selected {
            border-color: var(--primary-color);
            background: rgba(52, 152, 219, 0.1);
        }

        .scale-container {
            margin-top: 2rem;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .scale-buttons {
            display: flex;
            justify-content: space-between;
        }

        .scale-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e0e0e0;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scale-button:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .scale-button.selected {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding: 0 1rem;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .likert-radio {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .likert-radio:checked {
            border-color: var(--primary-color);
            background: var(--primary-color);
        }

        .likert-label {
            font-size: 0.9rem;
            color: #666;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .nav-button {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            background: var(--primary-color);
            color: white;
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-button:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .back-button {
            background: #95a5a6;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .role-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 3rem 0;
            animation: fadeInUp 0.8s ease;
        }

        .role-cards {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* è§’è‰²é€‰æ‹©é¡µé¢åº•éƒ¨æç¤ºä¿¡æ¯æ ·å¼ */
        .bottom-selector-info {
            margin-top: 2rem;
            text-align: center;
            color: #666;
            animation: pulse 2s infinite;
        }

        .bottom-selector-info p {
            font-size: 1.1rem;
            position: relative;
            display: inline-block;
        }

        .bottom-selector-info p:before,
        .bottom-selector-info p:after {
            content: 'ğŸ‘†';
            position: absolute;
            top: -1.5rem;
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .bottom-selector-info p:before {
            left: 25%;
            transform: translateX(-50%);
        }

        .bottom-selector-info p:after {
            right: 25%;
            transform: translateX(50%);
        }

        @keyframes pulse {
            0% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.7;
            }
        }

        .role-card {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 200px;
        }

        .role-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .role-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .role-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .role-description {
            font-size: 0.9rem;
            color: #666;
        }

        .results-container {
            display: none;
            animation: fadeInUp 0.8s ease;
        }

        .results-section {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .results-chart {
            margin: 2rem 0;
            height: 300px;
        }

        .trait-bar {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .trait-label {
            width: 120px;
            font-size: 0.9rem;
        }

        .trait-progress {
            flex-grow: 1;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .trait-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 1s ease;
        }

        .trait-value {
            width: 50px;
            text-align: right;
            font-size: 0.9rem;
            margin-left: 1rem;
        }

        .role-title-result {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .role-icon {
            font-size: 2rem;
            margin-right: 0.5rem;
        }

        .mbti-type {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .mbti-description {
            font-size: 1rem;
            color: #666;
        }

        .mbti-details {
            margin-top: 0.5rem;
        }

        .mbti-trait {
            margin-bottom: 0.25rem;
        }

        .disc-description {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .big5-description {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .communicationTips {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-header">
            <h1>äº²å­æ€§æ ¼åŒ¹é…åˆ†æ</h1>
            <p>é€šè¿‡ç§‘å­¦çš„æ€§æ ¼æµ‹è¯„ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£å½¼æ­¤ï¼Œæå‡æ²Ÿé€šæ•ˆæœ</p>
        </div>

        <div id="roleSelection" class="role-selection">
            <div class="role-cards">
                <div class="role-card" onclick="startTest('child')">
                    <div class="role-icon">ğŸ‘¶</div>
                    <div class="role-title">æˆ‘æ˜¯å­©å­</div>
                    <div class="role-description">é€‚åˆ6-15å²çš„é’å°‘å¹´ï¼Œå¸®åŠ©äº†è§£è‡ªå·±çš„æ€§æ ¼ç‰¹ç‚¹</div>
                </div>
                <div class="role-card" onclick="startTest('parent')">
                    <div class="role-icon">ğŸ‘¨â€ğŸ‘©</div>
                    <div class="role-title">æˆ‘æ˜¯å®¶é•¿</div>
                    <div class="role-description">é€‚åˆå®¶é•¿ï¼Œäº†è§£è‡ªå·±çš„æ•™è‚²é£æ ¼ä¸æ²Ÿé€šæ–¹å¼</div>
                </div>
            </div>

            <!-- åœ¨è§’è‰²é€‰æ‹©é¡µé¢åº•éƒ¨æ·»åŠ åˆ‡æ¢åŠŸèƒ½ -->
            <div class="bottom-selector-info">
                <p>è¯·é€‰æ‹©æ‚¨çš„è§’è‰²å¼€å§‹æµ‹è¯•</p>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="question-container" id="questionContainer" style="display: none;">
            <h2 id="questionTitle"></h2>
            <div class="question-text" id="questionText"></div>
            <div class="options-container" id="optionsContainer"></div>
            <div class="navigation-buttons">
                <button class="nav-button back-button" id="prevButton" onclick="previousQuestion()">ä¸Šä¸€é¢˜</button>
                <button class="nav-button" id="nextButton" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer" style="display: none;">
            <div class="results-section">
                <h2 class="results-title">MBTI æ€§æ ¼ç±»å‹</h2>
                <div id="mbtiResult"></div>
            </div>
            <div class="results-section" id="discSection">
                <h2 class="results-title">DISC è¡Œä¸ºé£æ ¼</h2>
                <div class="results-chart" id="discChart"></div>
            </div>
            <div class="results-section" id="bigFiveSection">
                <h2 class="results-title">å¤§äº”äººæ ¼ç‰¹è´¨</h2>
                <div class="results-chart" id="bigFiveChart"></div>
            </div>
            <div class="results-section">
                <div id="communicationTips"></div>
            </div>
            <div class="navigation-buttons">
                <button class="nav-button back-button" onclick="resetTest()">é‡æ–°æµ‹è¯•</button>
                <button class="nav-button" onclick="window.location.href='chat.html'">å¼€å§‹å¯¹è¯</button>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log("é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–æµ‹è¯•...");
                
                // åˆå§‹åŒ–é—®é¢˜åº“
                if (typeof questionBank === 'undefined') {
                    console.error("é—®é¢˜åº“æœªåŠ è½½!");
                    alert("é—®é¢˜åº“åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");
                    return;
                }
                console.log("é—®é¢˜åº“åŠ è½½å®Œæˆ:", questionBank);
                
                // è®¾ç½®å…¨å±€è®¿é—®å˜é‡
                window.questionBank = questionBank;
                
                // æ˜¾ç¤ºè§’è‰²é€‰æ‹©ç•Œé¢ï¼Œè€Œä¸æ˜¯ç›´æ¥å¼€å§‹æµ‹è¯•
                document.getElementById('roleSelection').style.display = 'flex';
                document.getElementById('questionContainer').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'none';
                
            } catch (error) {
                console.error("åˆå§‹åŒ–æµ‹è¯•æ—¶å‡ºé”™:", error);
            }
        });

        // å¼€å§‹æµ‹è¯•
        window.startTest = function(role) {
            console.log("å¯åŠ¨æµ‹è¯•ï¼Œè§’è‰²:", role);
            
            // è®¾ç½®è§’è‰²å¹¶ä¿å­˜åˆ°localStorage
            window.currentRole = role;
            localStorage.setItem('selectedRole', role);
            
            // åˆå§‹åŒ–æµ‹è¯•çŠ¶æ€
            window.currentSection = 'mbti';
            window.currentQuestionIndex = 0;
            window.answers = {
                mbti: [],
                disc: [],
                bigFive: []
            };

            // éšè—è§’è‰²é€‰æ‹©ç•Œé¢ï¼Œæ˜¾ç¤ºé—®é¢˜
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'block';
            
            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªé—®é¢˜
            showQuestion();
        };

        // æ˜¾ç¤ºå½“å‰é—®é¢˜
        window.showQuestion = function() {
            try {
                const question = getCurrentQuestion();
                
                if (!question) {
                    console.error("æ— æ³•è·å–å½“å‰é—®é¢˜");
                    return;
                }
                
                console.log("æ­£åœ¨æ˜¾ç¤ºé—®é¢˜:", question);
                
                // æ›´æ–°è¿›åº¦æ¡
                const totalQuestions = 
                    window.questionBank[window.currentRole].mbti.length + 
                    window.questionBank[window.currentRole].disc.length + 
                    window.questionBank[window.currentRole].bigFive.length;
                
                let completedQuestions = window.currentQuestionIndex;
                
                if (window.currentSection === 'disc') {
                    completedQuestions += window.questionBank[window.currentRole].mbti.length;
                } else if (window.currentSection === 'bigFive') {
                    completedQuestions += 
                        window.questionBank[window.currentRole].mbti.length + 
                        window.questionBank[window.currentRole].disc.length;
                }
                
                const progress = Math.floor((completedQuestions / totalQuestions) * 100);
                document.getElementById('progressBar').style.width = `${progress}%`;
                
                // æ›´æ–°é—®é¢˜æ ‡é¢˜
                let sectionTitle = '';
                if (window.currentSection === 'mbti') {
                    sectionTitle = 'MBTIæ€§æ ¼æµ‹è¯•';
                } else if (window.currentSection === 'disc') {
                    sectionTitle = 'DISCè¡Œä¸ºé£æ ¼';
                } else if (window.currentSection === 'bigFive') {
                    sectionTitle = 'å¤§äº”äººæ ¼æµ‹è¯•';
                }
                
                document.getElementById('questionTitle').textContent = sectionTitle;
                
                // æ˜¾ç¤ºé—®é¢˜æ–‡æœ¬
                const questionText = document.getElementById('questionText');
                questionText.textContent = question.question;
                
                // æ¸…é™¤ä¹‹å‰çš„é€‰é¡¹
                const optionsContainer = document.getElementById('optionsContainer');
                optionsContainer.innerHTML = '';
                
                // æ·»åŠ æ–°é€‰é¡¹
                if (window.currentSection === 'bigFive') {
                    // åˆ›å»ºå¤§äº”äººæ ¼çš„é‡è¡¨é€‰é¡¹
                    const scaleContainer = document.createElement('div');
                    scaleContainer.className = 'scale-container';
                    
                    // æ·»åŠ é‡è¡¨æ ‡ç­¾
                    const labelsContainer = document.createElement('div');
                    labelsContainer.className = 'scale-labels';
                    
                    const leftLabel = document.createElement('span');
                    leftLabel.textContent = 'å®Œå…¨ä¸åŒæ„';
                    
                    const rightLabel = document.createElement('span');
                    rightLabel.textContent = 'å®Œå…¨åŒæ„';
                    
                    labelsContainer.appendChild(leftLabel);
                    labelsContainer.appendChild(rightLabel);
                    scaleContainer.appendChild(labelsContainer);
                    
                    // æ·»åŠ é‡è¡¨æŒ‰é’®
                    const buttonsContainer = document.createElement('div');
                    buttonsContainer.className = 'scale-buttons';
                    
                    for (let i = 1; i <= 5; i++) {
                        const button = document.createElement('button');
                        button.className = 'scale-button';
                        button.setAttribute('data-value', i);
                        button.textContent = i;
                        
                        // æ£€æŸ¥æ˜¯å¦å·²é€‰æ‹©
                        if (window.answers[window.currentSection][window.currentQuestionIndex] === i) {
                            button.classList.add('selected');
                        }
                        
                        button.onclick = function() {
                            selectOption(i);
                        };
                        
                        buttonsContainer.appendChild(button);
                    }
                    
                    scaleContainer.appendChild(buttonsContainer);
                    optionsContainer.appendChild(scaleContainer);
                } else {
                    // åˆ›å»ºMBTIæˆ–DISCçš„é€‰é¡¹
                    for (let i = 0; i < question.options.length; i++) {
                        const option = document.createElement('div');
                        option.className = 'option';
                        
                        // æ£€æŸ¥æ˜¯å¦å·²é€‰æ‹©
                        if (window.answers[window.currentSection][window.currentQuestionIndex] === i) {
                            option.classList.add('selected');
                        }
                        
                        option.onclick = function() {
                            selectOption(i);
                        };
                        
                        const optionText = document.createElement('p');
                        optionText.textContent = question.options[i].text;
                        option.appendChild(optionText);
                        
                        optionsContainer.appendChild(option);
                    }
                }
                
                // æ›´æ–°å¯¼èˆªæŒ‰é’®
                const prevButton = document.getElementById('prevButton');
                const nextButton = document.getElementById('nextButton');
                
                // ç¬¬ä¸€ä¸ªé—®é¢˜æ²¡æœ‰ä¸Šä¸€é¢˜æŒ‰é’®
                if (window.currentSection === 'mbti' && window.currentQuestionIndex === 0) {
                    prevButton.style.visibility = 'hidden';
                } else {
                    prevButton.style.visibility = 'visible';
                }
                
                // æœ€åä¸€ä¸ªé—®é¢˜æ˜¾ç¤ºå®ŒæˆæŒ‰é’®
                if (window.currentSection === 'bigFive' && 
                    window.currentQuestionIndex === window.questionBank[window.currentRole].bigFive.length - 1) {
                    nextButton.textContent = 'å®Œæˆæµ‹è¯•';
                } else {
                    nextButton.textContent = 'ä¸‹ä¸€é¢˜';
                }
            } catch (error) {
                console.error("æ˜¾ç¤ºé—®é¢˜æ—¶å‡ºé”™:", error);
            }
        };

        // è·å–å½“å‰é—®é¢˜
        window.getCurrentQuestion = function() {
            console.log("è·å–é—®é¢˜ - è§’è‰²:", window.currentRole, "éƒ¨åˆ†:", window.currentSection, "ç´¢å¼•:", window.currentQuestionIndex);
            
            try {
                // æ£€æŸ¥é—®é¢˜åº“æ˜¯å¦å­˜åœ¨
                if (!window.questionBank) {
                    console.error("é—®é¢˜åº“æœªå®šä¹‰!");
                    return null;
                }
                
                // æ£€æŸ¥è§’è‰²æ˜¯å¦æœ‰æ•ˆ
                if (!window.questionBank[window.currentRole]) {
                    console.error("æ— æ•ˆçš„è§’è‰²:", window.currentRole);
                    console.log("å¯ç”¨è§’è‰²:", Object.keys(window.questionBank));
                    return null;
                }
                
                // æ£€æŸ¥æµ‹è¯•éƒ¨åˆ†æ˜¯å¦æœ‰æ•ˆ
                if (!window.questionBank[window.currentRole][window.currentSection]) {
                    console.error("æ— æ•ˆçš„æµ‹è¯•éƒ¨åˆ†:", window.currentSection);
                    console.log("å¯ç”¨éƒ¨åˆ†:", Object.keys(window.questionBank[window.currentRole]));
                    return null;
                }
                
                // è·å–å½“å‰éƒ¨åˆ†çš„é—®é¢˜
                const questions = window.questionBank[window.currentRole][window.currentSection];
                
                // æ£€æŸ¥é—®é¢˜ç´¢å¼•æ˜¯å¦æœ‰æ•ˆ
                if (window.currentQuestionIndex < 0 || window.currentQuestionIndex >= questions.length) {
                    console.error("æ— æ•ˆçš„é—®é¢˜ç´¢å¼•:", window.currentQuestionIndex, "é—®é¢˜æ•°é‡:", questions.length);
                    return null;
                }
                
                return questions[window.currentQuestionIndex];
            } catch (error) {
                console.error("è·å–é—®é¢˜æ—¶å‡ºé”™:", error);
                return null;
            }
        };

        // é€‰æ‹©é€‰é¡¹
        window.selectOption = function(optionIndex) {
            try {
                const question = getCurrentQuestion();
                if (!question) {
                    console.error("æ— æ³•è·å–å½“å‰é—®é¢˜");
                    return;
                }
                
                console.log("é€‰æ‹©é€‰é¡¹", optionIndex, "å¯¹äºé—®é¢˜", question.question);
                
                // ç®€åŒ–ç­”æ¡ˆè®°å½•ï¼Œåªå­˜å‚¨ç´¢å¼•
                window.answers[window.currentSection][window.currentQuestionIndex] = optionIndex;
                
                // æ›´æ–°UIæ˜¾ç¤ºå·²é€‰æ‹©çš„é€‰é¡¹
                const optionsContainer = document.getElementById('optionsContainer');
                
                if (window.currentSection === 'bigFive') {
                    // å¤§äº”äººæ ¼çš„é‡è¡¨é€‰é¡¹
                    const scaleButtons = optionsContainer.querySelectorAll('.scale-button');
                    scaleButtons.forEach(button => {
                        if (parseInt(button.getAttribute('data-value')) === optionIndex) {
                            button.classList.add('selected');
                        } else {
                            button.classList.remove('selected');
                        }
                    });
                } else {
                    // MBTIå’ŒDISCçš„é€‰é¡¹
                    const options = optionsContainer.querySelectorAll('.option');
                    options.forEach((option, idx) => {
                        if (idx === optionIndex) {
                            option.classList.add('selected');
                        } else {
                            option.classList.remove('selected');
                        }
                    });
                }
                
                // è‡ªåŠ¨å‰è¿›åˆ°ä¸‹ä¸€é¢˜
                setTimeout(() => {
                    nextQuestion();
                }, 500);
            } catch (error) {
                console.error("é€‰æ‹©é€‰é¡¹æ—¶å‡ºé”™:", error);
            }
        };

        // ä¸Šä¸€é¢˜
        window.previousQuestion = function() {
            try {
                if (window.currentQuestionIndex > 0) {
                    window.currentQuestionIndex--;
                } else if (window.currentSection === 'disc') {
                    window.currentSection = 'mbti';
                    window.currentQuestionIndex = window.questionBank[window.currentRole].mbti.length - 1;
                } else if (window.currentSection === 'bigFive') {
                    window.currentSection = 'disc';
                    window.currentQuestionIndex = window.questionBank[window.currentRole].disc.length - 1;
                }
                showQuestion();
            } catch (error) {
                console.error("è¿”å›ä¸Šä¸€é¢˜æ—¶å‡ºé”™:", error);
            }
        };

        // ä¸‹ä¸€é¢˜
        window.nextQuestion = function() {
            try {
                // è·å–å½“å‰éƒ¨åˆ†çš„é—®é¢˜æ•°é‡
                const currentSectionQuestions = window.questionBank[window.currentRole][window.currentSection];
                
                // æ£€æŸ¥æ˜¯å¦å·²å›ç­”å½“å‰é—®é¢˜
                if (window.answers[window.currentSection][window.currentQuestionIndex] === undefined) {
                    alert("è¯·å…ˆå›ç­”å½“å‰é—®é¢˜");
                    return;
                }
                
                if (window.currentQuestionIndex < currentSectionQuestions.length - 1) {
                    // å‰è¿›åˆ°ä¸‹ä¸€ä¸ªé—®é¢˜
                    window.currentQuestionIndex++;
                    showQuestion();
                } else {
                    // å½“å‰éƒ¨åˆ†çš„é—®é¢˜å·²å®Œæˆï¼Œç§»åŠ¨åˆ°ä¸‹ä¸€éƒ¨åˆ†
                    if (window.currentSection === 'mbti') {
                        window.currentSection = 'disc';
                        window.currentQuestionIndex = 0;
                        showQuestion();
                    } else if (window.currentSection === 'disc') {
                        window.currentSection = 'bigFive';
                        window.currentQuestionIndex = 0;
                        showQuestion();
                    } else {
                        // æ‰€æœ‰éƒ¨åˆ†éƒ½å·²å®Œæˆ
                        showResults();
                    }
                }
            } catch (error) {
                console.error("å‰è¿›åˆ°ä¸‹ä¸€é¢˜æ—¶å‡ºé”™:", error);
                // å‡ºé”™æ—¶ä¹Ÿå°è¯•æ˜¾ç¤ºç»“æœ
                showResults();
            }
        };

        // æ˜¾ç¤ºç»“æœ
        window.showResults = function() {
            try {
                console.log("æ˜¾ç¤ºæµ‹è¯•ç»“æœ...");
                
                // éšè—é—®é¢˜å®¹å™¨ï¼Œæ˜¾ç¤ºç»“æœå®¹å™¨
                document.getElementById('questionContainer').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'block';
                
                // åˆ›å»ºä¸´æ—¶çš„åˆ†æç»“æœï¼ˆå®é™…é¡¹ç›®ä¸­è¿™åº”è¯¥è°ƒç”¨personality_questions.jsä¸­çš„åˆ†æå‡½æ•°ï¼‰
                // å‡è®¾MBTIåˆ†æç»“æœ
                const mbtiResult = {
                    EI: window.currentRole === 'child' ? 'I' : 'E',
                    SN: window.currentRole === 'child' ? 'N' : 'S',
                    TF: window.currentRole === 'child' ? 'F' : 'T',
                    JP: window.currentRole === 'child' ? 'P' : 'J'
                };
                
                // å‡è®¾DISCåˆ†æç»“æœ
                const discResult = {
                    D: window.currentRole === 'child' ? 65 : 75,
                    I: window.currentRole === 'child' ? 80 : 60,
                    S: window.currentRole === 'child' ? 50 : 65,
                    C: window.currentRole === 'child' ? 40 : 85
                };
                
                // å‡è®¾å¤§äº”äººæ ¼åˆ†æç»“æœ
                const bigFiveResult = {
                    å¤–å‘æ€§: window.currentRole === 'child' ? 3 : 4,
                    å®œäººæ€§: window.currentRole === 'child' ? 4 : 3,
                    å°½è´£æ€§: window.currentRole === 'child' ? 3 : 5,
                    æƒ…ç»ªç¨³å®šæ€§: window.currentRole === 'child' ? 2 : 4,
                    å¼€æ”¾æ€§: window.currentRole === 'child' ? 5 : 3
                };
                
                // æ˜¾ç¤ºMBTIç»“æœ
                const mbtiResultContainer = document.getElementById('mbtiResult');
                
                let mbtiType = "";
                for (const dim in mbtiResult) {
                    mbtiType += mbtiResult[dim];
                }
                
                let mbtiDescription = getMBTIDescription(mbtiType);
                
                mbtiResultContainer.innerHTML = `
                    <div class="mbti-type">${mbtiType}</div>
                    <div class="mbti-description">${mbtiDescription}</div>
                    <div class="mbti-details">
                        <div class="mbti-trait">${mbtiResult.EI === 'E' ? 'å¤–å‘å‹' : 'å†…å‘å‹'}: ${mbtiResult.EI === 'E' ? 'ä»å¤–éƒ¨ä¸–ç•Œè·å–èƒ½é‡' : 'ä»å†…å¿ƒä¸–ç•Œè·å–èƒ½é‡'}</div>
                        <div class="mbti-trait">${mbtiResult.SN === 'S' ? 'å®æ„Ÿå‹' : 'ç›´è§‰å‹'}: ${mbtiResult.SN === 'S' ? 'å…³æ³¨å…·ä½“ç»†èŠ‚å’Œäº‹å®' : 'å…³æ³¨å¯èƒ½æ€§å’Œæ¦‚å¿µ'}</div>
                        <div class="mbti-trait">${mbtiResult.TF === 'T' ? 'æ€è€ƒå‹' : 'æƒ…æ„Ÿå‹'}: ${mbtiResult.TF === 'T' ? 'åŸºäºé€»è¾‘åšå†³å®š' : 'åŸºäºä»·å€¼è§‚å’Œæƒ…æ„Ÿåšå†³å®š'}</div>
                        <div class="mbti-trait">${mbtiResult.JP === 'J' ? 'åˆ¤æ–­å‹' : 'æ„ŸçŸ¥å‹'}: ${mbtiResult.JP === 'J' ? 'å–œæ¬¢è®¡åˆ’å’Œç»„ç»‡' : 'å–œæ¬¢çµæ´»å’Œè‡ªå‘'}</div>
                    </div>
                `;
                
                // æ˜¾ç¤ºDISCç»“æœ
                const discChartContainer = document.getElementById('discChart');
                
                const discBarChart = `
                    <div class="trait-bar">
                        <div class="trait-label">æ”¯é…æ€§ (D)</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${discResult.D}%;"></div>
                        </div>
                        <div class="trait-value">${discResult.D}%</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">å½±å“æ€§ (I)</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${discResult.I}%;"></div>
                        </div>
                        <div class="trait-value">${discResult.I}%</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">ç¨³å®šæ€§ (S)</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${discResult.S}%;"></div>
                        </div>
                        <div class="trait-value">${discResult.S}%</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">è°¨æ…æ€§ (C)</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${discResult.C}%;"></div>
                        </div>
                        <div class="trait-value">${discResult.C}%</div>
                    </div>
                    <div class="disc-description">
                        ${getDISCDescription(discResult)}
                    </div>
                `;
                
                discChartContainer.innerHTML = discBarChart;
                
                // æ˜¾ç¤ºå¤§äº”äººæ ¼ç»“æœ
                const bigFiveChartContainer = document.getElementById('bigFiveChart');
                
                const bigFiveBarChart = `
                    <div class="trait-bar">
                        <div class="trait-label">å¤–å‘æ€§</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.å¤–å‘æ€§ * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.å¤–å‘æ€§}</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">å®œäººæ€§</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.å®œäººæ€§ * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.å®œäººæ€§}</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">å°½è´£æ€§</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.å°½è´£æ€§ * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.å°½è´£æ€§}</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">æƒ…ç»ªç¨³å®šæ€§</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.æƒ…ç»ªç¨³å®šæ€§ * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.æƒ…ç»ªç¨³å®šæ€§}</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">å¼€æ”¾æ€§</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.å¼€æ”¾æ€§ * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.å¼€æ”¾æ€§}</div>
                    </div>
                    <div class="big5-description">
                        ${getBigFiveDescription(bigFiveResult)}
                    </div>
                `;
                
                bigFiveChartContainer.innerHTML = bigFiveBarChart;
                
                // æ˜¾ç¤ºæ²Ÿé€šå»ºè®®
                const communicationTips = document.getElementById('communicationTips');
                communicationTips.innerHTML = `
                    <h2 class="results-title">æ²Ÿé€šå»ºè®®</h2>
                    <p>${getCommunicationTips(window.currentRole, mbtiType, discResult, bigFiveResult)}</p>
                `;
                
                // ä¿å­˜æµ‹è¯•ç»“æœåˆ°localStorage
                const testResults = {
                    role: window.currentRole,
                    mbti: mbtiType,
                    disc: discResult,
                    bigFive: bigFiveResult,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('personalityTestResults', JSON.stringify(testResults));
                
            } catch (error) {
                console.error("æ˜¾ç¤ºç»“æœæ—¶å‡ºé”™:", error);
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="results-section">
                        <h2 class="results-title">æµ‹è¯•ç»“æœè®¡ç®—å‡ºé”™</h2>
                        <p>æŠ±æ­‰ï¼Œè®¡ç®—ç»“æœæ—¶å‡ºç°é”™è¯¯ã€‚è¯·å°è¯•é‡æ–°æµ‹è¯•ã€‚</p>
                        <button class="nav-button" onclick="resetTest()">é‡æ–°æµ‹è¯•</button>
                    </div>
                `;
            }
        };

        // MBTIç±»å‹æè¿°
        function getMBTIDescription(type) {
            const descriptions = {
                'ISTJ': 'å®‰é™è®¤çœŸï¼Œé€šè¿‡å…¨é¢æ€§å’Œå¯é æ€§è·å¾—æˆåŠŸã€‚å®é™…ï¼Œæ³¨é‡äº‹å®ï¼Œæœ‰è´£ä»»æ„Ÿã€‚ç†æ€§åœ°å†³å®šåº”è¯¥åšä»€ä¹ˆï¼Œä¸å—å¹²æ‰°åœ°å·¥ä½œã€‚',
                'ISFJ': 'å®‰é™ï¼Œå‹å¥½ï¼Œæœ‰è´£ä»»æ„Ÿå’Œè°¨æ…ã€‚è‡´åŠ›äºå±¥è¡Œä¹‰åŠ¡ã€‚ç»†è‡´ï¼Œç²¾ç¡®ï¼Œå‡†ç¡®ã€‚å¿ è¯šï¼Œä½“è´´ï¼Œç•™å¿ƒå¹¶å…³å¿ƒé‡è¦ä»–äººçš„æ„Ÿå—ã€‚',
                'INFJ': 'å¯»æ±‚æ„ä¹‰å’Œè”ç³»ï¼Œç†è§£äººé™…å…³ç³»ä¸­çš„å¤æ‚æ€§ã€‚å¯¹äºä»–äººçš„æ„Ÿè§‰å’Œéœ€è¦éå¸¸æ•æ„Ÿã€‚æœ‰è´£ä»»æ„Ÿï¼Œè‡´åŠ›äºè‡ªå·±çš„ä»·å€¼è§‚ã€‚',
                'INTJ': 'å¯¹è‡ªå·±çš„æƒ³æ³•å’Œåˆ›é€ åŠ›æœ‰å¾ˆå¼ºçš„é©±åŠ¨åŠ›ï¼Œæœ‰å†…åœ¨çš„æ„¿æ™¯ï¼Œæœ‰èƒ½åŠ›åˆ†æé—®é¢˜å¹¶é«˜æ•ˆåœ°ç»„ç»‡æ¦‚å¿µå’Œæƒ³æ³•ã€‚',
                'ISTP': 'å®½å®¹ï¼Œçµæ´»ï¼Œå®‰é™åœ°è§‚å¯Ÿç›´åˆ°é—®é¢˜å‡ºç°ï¼Œç„¶åè¿…é€Ÿè¡ŒåŠ¨æ‰¾åˆ°å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚å¯¹äº‹å®å’ŒåŸå› æ„Ÿå…´è¶£ï¼Œåˆ†æåŸç†å¦‚ä½•è¿ä½œã€‚',
                'ISFP': 'å®‰é™ï¼Œå‹å¥½ï¼Œæ•æ„Ÿï¼Œä»æ…ˆã€‚äº«å—å½“ä¸‹ï¼Œå–œæ¬¢è‡ªå·±çš„ç©ºé—´ä»¥åŠæŒ‰ç…§è‡ªå·±çš„æ—¶é—´è¡¨å·¥ä½œã€‚å¿ è¯šï¼Œæ„¿æ„å¥‰çŒ®ç»™é‡è¦çš„äººã€‚',
                'INFP': 'ç†æƒ³ä¸»ä¹‰è€…ï¼Œå¿ äºè‡ªå·±çš„ä»·å€¼è§‚å’Œé‡è¦çš„äººã€‚å¤–éƒ¨ç”Ÿæ´»ä¸å†…åœ¨ä»·å€¼ä¸€è‡´ã€‚å¥½å¥‡ï¼Œè¿…é€Ÿçœ‹åˆ°å¯èƒ½æ€§ï¼Œå‚¬åŒ–ä»–äººæƒ³æ³•çš„å®ç°ã€‚',
                'INTP': 'å¯»æ±‚å‘ç°é€»è¾‘è§£é‡Šï¼Œç†è®ºæ€§å…´è¶£è¾ƒå¼ºï¼ŒæŠ½è±¡æ€è€ƒï¼Œä¸å–œæ¬¢é—²èŠã€‚å®‰é™ï¼Œçµæ´»ï¼Œé€‚åº”åŠ›å¼ºï¼Œä¸“æ³¨èƒ½åŠ›æƒŠäººã€‚',
                'ESTP': 'çµæ´»å’Œå®¹å¿ï¼Œé‡‡å–å®ç”¨çš„æ–¹æ³•ï¼Œå…³æ³¨å³æ—¶ç»“æœã€‚ç†è®ºå’Œæ¦‚å¿µè§£é‡Šä½¿ä»–ä»¬ä¸è€çƒ¦ã€‚å–œæ¬¢ç§¯æå‚ä¸è§£å†³é—®é¢˜ã€‚',
                'ESFP': 'å¤–å‘ï¼Œå‹å¥½ï¼Œæ¥å—åŠ›å¼ºã€‚çƒ­çˆ±ç”Ÿæ´»ï¼Œäººå’Œç‰©è´¨äº«å—ã€‚å–œæ¬¢ä¸ä»–äººä¸€èµ·å·¥ä½œï¼Œå°†å¸¸è¯†å’Œç°å®æ€åº¦å¸¦å…¥å·¥ä½œä¸­ã€‚',
                'ENFP': 'çƒ­æƒ…ï¼Œæœ‰æƒ³è±¡åŠ›ã€‚æŠŠç”Ÿæ´»è§†ä¸ºå……æ»¡å¯èƒ½æ€§ã€‚èƒ½å¤Ÿå¿«é€Ÿè”ç³»äº‹ä»¶å’Œä¿¡æ¯ï¼Œè‡ªä¿¡åœ°åŸºäºæ¨¡å¼åšå†³å®šã€‚',
                'ENTP': 'æ•æ·ï¼Œæœ‰åˆ›é€ æ€§ï¼Œå–„äºåˆºæ¿€æ€§è¾©è®ºã€‚è¶³æ™ºå¤šè°‹è§£å†³æ–°çš„å…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ã€‚å–„äºäº§ç”Ÿæ¦‚å¿µæ€§å¯èƒ½æ€§ï¼Œç„¶ååˆ†æå®ƒä»¬ã€‚',
                'ESTJ': 'å®é™…ï¼Œç°å®ï¼Œæ³¨é‡äº‹å®ã€‚æœæ–­ï¼Œè¿…é€Ÿå®æ–½å†³ç­–ã€‚ç»„ç»‡é¡¹ç›®å’Œäººå‘˜å®ç°ç›®æ ‡ï¼Œä¸“æ³¨äºåŠæ—¶è·å¾—ç»“æœã€‚',
                'ESFJ': 'çƒ­å¿ƒï¼Œæœ‰è‰¯å¿ƒï¼Œåˆä½œã€‚å¸Œæœ›ä¸ä»–äººå’Œè°ç›¸å¤„ï¼ŒåŠªåŠ›å·¥ä½œä»¥å‡†ç¡®å®Œæˆå·¥ä½œã€‚å¿ è¯šï¼Œä¼šæ³¨æ„åˆ°ä»–äººéœ€è¦çš„ç»†èŠ‚ã€‚',
                'ENFJ': 'æ¸©æš–ï¼ŒåŒæƒ…ï¼Œæ•æ„Ÿï¼Œè´Ÿè´£ä»»ã€‚é«˜åº¦å…³æ³¨ä»–äººçš„æƒ…æ„Ÿã€éœ€è¦å’ŒåŠ¨æœºã€‚å–„äºçœ‹åˆ°ä»–äººçš„æ½œåŠ›ï¼Œå¸Œæœ›å¸®åŠ©ä»–ä»¬å®ç°æ½œåŠ›ã€‚',
                'ENTJ': 'å¦ç‡ï¼Œæœæ–­ï¼Œæœ‰é¢†å¯¼èƒ½åŠ›ã€‚è¿…é€Ÿçœ‹åˆ°ä¸åˆé€»è¾‘å’Œä½æ•ˆçš„ç¨‹åºå’Œæ”¿ç­–ï¼Œå‘å±•å¹¶å®æ–½å…¨é¢ç³»ç»Ÿä»¥è§£å†³ç»„ç»‡é—®é¢˜ã€‚'
            };
            
            return descriptions[type] || 'æ²¡æœ‰æ‰¾åˆ°æ­¤ç±»å‹çš„æè¿°ã€‚';
        }

        // DISCæè¿°
        function getDISCDescription(discResult) {
            // æ‰¾å‡ºä¸»å¯¼ç‰¹è´¨
            let dominantTrait = '';
            let maxScore = 0;
            
            for (const trait in discResult) {
                if (discResult[trait] > maxScore) {
                    maxScore = discResult[trait];
                    dominantTrait = trait;
                }
            }
            
            const descriptions = {
                'D': 'ä½ å€¾å‘äºç›´æ¥ã€æœæ–­ï¼Œå–œæ¬¢æ¥å—æŒ‘æˆ˜å’Œè§£å†³é—®é¢˜ã€‚ä½ å¯èƒ½æ›´æ³¨é‡ç»“æœè€Œä¸æ˜¯è¿‡ç¨‹ï¼Œå€¾å‘äºå¿«é€Ÿåšå†³å®šã€‚',
                'I': 'ä½ å€¾å‘äºå¤–å‘ã€çƒ­æƒ…ï¼Œå–œæ¬¢ä¸äººäº¤æµå’Œå»ºç«‹å…³ç³»ã€‚ä½ å¯èƒ½å–„äºæ¿€åŠ±ä»–äººï¼Œåœ¨å›¢é˜Ÿä¸­æœ‰è¾ƒå¼ºçš„æ„ŸæŸ“åŠ›ã€‚',
                'S': 'ä½ å€¾å‘äºç¨³å®šã€è€å¿ƒï¼Œå–œæ¬¢å›¢é˜Ÿåˆä½œå’Œç»´æŒå’Œè°ã€‚ä½ å¯èƒ½è¡¨ç°å‡ºå¾ˆå¼ºçš„å¿ è¯šåº¦ï¼Œå¯¹ä»–äººçš„éœ€æ±‚å¾ˆæ•æ„Ÿã€‚',
                'C': 'ä½ å€¾å‘äºç²¾ç¡®ã€è°¨æ…ï¼Œå–œæ¬¢ç»†èŠ‚å’Œé«˜è´¨é‡çš„å·¥ä½œã€‚ä½ å¯èƒ½ä¼šä»”ç»†åˆ†ææƒ…å†µï¼Œåœ¨åšå†³å®šå‰æ”¶é›†è¶³å¤Ÿä¿¡æ¯ã€‚'
            };
            
            return descriptions[dominantTrait] || 'ä½ çš„DISCç‰¹è´¨åˆ†å¸ƒç›¸å¯¹å¹³è¡¡ï¼Œè¡¨ç°å‡ºå¤šæ–¹é¢çš„è¡Œä¸ºç‰¹ç‚¹ã€‚';
        }

        // å¤§äº”äººæ ¼æè¿°
        function getBigFiveDescription(bigFiveResult) {
            let description = 'ä½ çš„äººæ ¼ç‰¹è´¨åŒ…æ‹¬ï¼š';
            
            if (bigFiveResult.å¤–å‘æ€§ >= 4) {
                description += 'è¾ƒé«˜çš„å¤–å‘æ€§ï¼Œå–œæ¬¢ç¤¾äº¤äº’åŠ¨ï¼Œç²¾åŠ›å……æ²›ï¼›';
            } else if (bigFiveResult.å¤–å‘æ€§ <= 2) {
                description += 'è¾ƒä½çš„å¤–å‘æ€§ï¼Œåå¥½ç‹¬å¤„ï¼Œå®‰é™æ€è€ƒï¼›';
            }
            
            if (bigFiveResult.å®œäººæ€§ >= 4) {
                description += 'è¾ƒé«˜çš„å®œäººæ€§ï¼Œå¯Œæœ‰åŒæƒ…å¿ƒï¼Œä¹äºå¸®åŠ©ä»–äººï¼›';
            } else if (bigFiveResult.å®œäººæ€§ <= 2) {
                description += 'è¾ƒä½çš„å®œäººæ€§ï¼Œæ›´ç›´æ¥å¦ç‡ï¼Œç‹¬ç«‹æ€è€ƒï¼›';
            }
            
            if (bigFiveResult.å°½è´£æ€§ >= 4) {
                description += 'è¾ƒé«˜çš„å°½è´£æ€§ï¼Œæœ‰æ¡ç†ï¼Œæ³¨é‡ç›®æ ‡ï¼›';
            } else if (bigFiveResult.å°½è´£æ€§ <= 2) {
                description += 'è¾ƒä½çš„å°½è´£æ€§ï¼Œæ›´éšæ€§çµæ´»ï¼Œä¸æ‹˜å°èŠ‚ï¼›';
            }
            
            if (bigFiveResult.æƒ…ç»ªç¨³å®šæ€§ >= 4) {
                description += 'è¾ƒé«˜çš„æƒ…ç»ªç¨³å®šæ€§ï¼Œå†·é™è‡ªä¿¡ï¼Œå‹åŠ›ç®¡ç†èƒ½åŠ›å¼ºï¼›';
            } else if (bigFiveResult.æƒ…ç»ªç¨³å®šæ€§ <= 2) {
                description += 'è¾ƒä½çš„æƒ…ç»ªç¨³å®šæ€§ï¼Œæƒ…æ„Ÿä¸°å¯Œï¼Œå¯¹ç¯å¢ƒæ•æ„Ÿï¼›';
            }
            
            if (bigFiveResult.å¼€æ”¾æ€§ >= 4) {
                description += 'è¾ƒé«˜çš„å¼€æ”¾æ€§ï¼Œå–œæ¬¢æ–°ä½“éªŒï¼Œæ€æƒ³å¼€æ”¾ã€‚';
            } else if (bigFiveResult.å¼€æ”¾æ€§ <= 2) {
                description += 'è¾ƒä½çš„å¼€æ”¾æ€§ï¼Œæ›´åŠ¡å®ä¼ ç»Ÿï¼Œæ³¨é‡å®é™…ç»éªŒã€‚';
            }
            
            return description;
        }

        // æ²Ÿé€šå»ºè®®
        function getCommunicationTips(role, mbtiType, discResult, bigFiveResult) {
            if (role === 'child') {
                return `ä½œä¸ºä¸€ä¸ª${mbtiType}æ€§æ ¼ç±»å‹çš„å­©å­ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢${mbtiType.includes('E') ? 'é€šè¿‡äº¤æµ' : 'ç‹¬ç«‹æ€è€ƒ'}æ¥è§£å†³é—®é¢˜ã€‚
                ä¸å®¶é•¿æ²Ÿé€šæ—¶ï¼Œå°è¯•æ¸…æ™°è¡¨è¾¾ä½ çš„æƒ³æ³•å’Œæ„Ÿå—ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æ„Ÿåˆ°ä¸è¢«ç†è§£æ—¶ã€‚
                ä½ çš„DISCç‰¹è´¨è¡¨æ˜ä½ åœ¨æ²Ÿé€šä¸­${getDISCCommunicationStyle(discResult)}ã€‚
                æ ¹æ®ä½ çš„å¤§äº”äººæ ¼ç‰¹è´¨ï¼Œå»ºè®®ä½ å…³æ³¨è‡ªå·±çš„${getBigFiveCommunicationFocus(bigFiveResult)}ï¼Œ
                è¿™å°†å¸®åŠ©ä½ ä¸å®¶é•¿å»ºç«‹æ›´å¥½çš„æ²Ÿé€šå’Œç†è§£ã€‚`;
            } else {
                return `ä½œä¸ºä¸€ä¸ª${mbtiType}æ€§æ ¼ç±»å‹çš„å®¶é•¿ï¼Œä½ å¯èƒ½åå¥½${mbtiType.includes('J') ? 'ç»“æ„åŒ–çš„' : 'çµæ´»çš„'}æ•™è‚²æ–¹å¼ã€‚
                ä¸å­©å­æ²Ÿé€šæ—¶ï¼Œè®°ä½ä»–ä»¬å¯èƒ½ä¸ä½ æœ‰ä¸åŒçš„æ€è€ƒå’Œæ„Ÿå—æ–¹å¼ï¼Œå°è¯•ç«™åœ¨ä»–ä»¬çš„è§’åº¦ç†è§£é—®é¢˜ã€‚
                ä½ çš„DISCç‰¹è´¨è¡¨æ˜ä½ åœ¨æ•™è‚²ä¸­${getDISCParentingStyle(discResult)}ã€‚
                æ ¹æ®ä½ çš„å¤§äº”äººæ ¼ç‰¹è´¨ï¼Œå»ºè®®ä½ å…³æ³¨${getBigFiveParentingFocus(bigFiveResult)}ï¼Œ
                è¿™å°†å¸®åŠ©ä½ æ›´æœ‰æ•ˆåœ°å¼•å¯¼å­©å­çš„æˆé•¿å’Œå‘å±•ã€‚`;
            }
        }

        function getDISCCommunicationStyle(discResult) {
            // æ‰¾å‡ºä¸»å¯¼ç‰¹è´¨
            let dominantTrait = '';
            let maxScore = 0;
            
            for (const trait in discResult) {
                if (discResult[trait] > maxScore) {
                    maxScore = discResult[trait];
                    dominantTrait = trait;
                }
            }
            
            const styles = {
                'D': 'å¯èƒ½æ¯”è¾ƒç›´æ¥ï¼Œå–œæ¬¢å¿«é€Ÿå¾—åˆ°ç­”æ¡ˆï¼Œå»ºè®®å­¦ä¹ è€å¿ƒå¬å–ä»–äººæ„è§',
                'I': 'å–„äºè¡¨è¾¾ï¼Œå–œæ¬¢åˆ†äº«æƒ³æ³•ï¼Œå»ºè®®æ³¨æ„å€¾å¬ä»–äººçš„åé¦ˆ',
                'S': 'å–„è§£äººæ„ï¼Œæ„¿æ„é…åˆï¼Œå»ºè®®é€‚å½“è¡¨è¾¾è‡ªå·±çš„éœ€æ±‚å’Œç«‹åœº',
                'C': 'æ³¨é‡ç»†èŠ‚å’Œç²¾ç¡®ï¼Œå»ºè®®å­¦ä¼šæ¥å—ä¸å®Œç¾çš„æƒ…å†µå’Œçµæ´»åº”å¯¹'
            };
            
            return styles[dominantTrait] || 'åœ¨ä¸åŒæƒ…å¢ƒä¸‹çµæ´»è°ƒæ•´æ²Ÿé€šæ–¹å¼';
        }

        function getDISCParentingStyle(discResult) {
            // æ‰¾å‡ºä¸»å¯¼ç‰¹è´¨
            let dominantTrait = '';
            let maxScore = 0;
            
            for (const trait in discResult) {
                if (discResult[trait] > maxScore) {
                    maxScore = discResult[trait];
                    dominantTrait = trait;
                }
            }
            
            const styles = {
                'D': 'å¯èƒ½è®¾å®šæ˜ç¡®ç›®æ ‡å’Œè§„åˆ™ï¼Œå»ºè®®å¤šå…³æ³¨å­©å­çš„æƒ…æ„Ÿéœ€æ±‚',
                'I': 'å–„äºæ¿€åŠ±å’Œé¼“åŠ±å­©å­ï¼Œå»ºè®®å¢åŠ å¯¹è§„åˆ™å’Œä¸€è‡´æ€§çš„é‡è§†',
                'S': 'èƒ½ä¸ºå­©å­æä¾›ç¨³å®šå’Œæ”¯æŒï¼Œå»ºè®®é€‚å½“ç»™å­©å­æ›´å¤šæŒ‘æˆ˜å’Œæˆé•¿ç©ºé—´',
                'C': 'æ³¨é‡æ•™è‚²çš„è´¨é‡å’Œæ ‡å‡†ï¼Œå»ºè®®æ¥å—å­©å­çš„ä¸å®Œç¾å’Œä¸ªæ€§å·®å¼‚'
            };
            
            return styles[dominantTrait] || 'èƒ½æ ¹æ®å­©å­çš„éœ€è¦è°ƒæ•´æ•™è‚²æ–¹å¼';
        }

        function getBigFiveCommunicationFocus(bigFiveResult) {
            let focus = [];
            
            if (bigFiveResult.å¤–å‘æ€§ <= 3) {
                focus.push('ä¸»åŠ¨è¡¨è¾¾è‡ªå·±çš„æƒ³æ³•');
            }
            
            if (bigFiveResult.å®œäººæ€§ <= 3) {
                focus.push('åŸ¹å…»åŒç†å¿ƒ');
            }
            
            if (bigFiveResult.å°½è´£æ€§ <= 3) {
                focus.push('å…»æˆè‰¯å¥½ä¹ æƒ¯');
            }
            
            if (bigFiveResult.æƒ…ç»ªç¨³å®šæ€§ <= 3) {
                focus.push('æƒ…ç»ªç®¡ç†');
            }
            
            if (bigFiveResult.å¼€æ”¾æ€§ <= 3) {
                focus.push('å¼€æ”¾æ€ç»´');
            }
            
            if (focus.length === 0) {
                focus.push('ç»§ç»­ä¿æŒè‰¯å¥½çš„æ²Ÿé€šä¹ æƒ¯');
            }
            
            return focus.join('å’Œ');
        }

        function getBigFiveParentingFocus(bigFiveResult) {
            let focus = [];
            
            if (bigFiveResult.å¤–å‘æ€§ <= 3) {
                focus.push('ä¸å­©å­åˆ›é€ æ›´å¤šäº’åŠ¨æœºä¼š');
            }
            
            if (bigFiveResult.å®œäººæ€§ <= 3) {
                focus.push('ç†è§£å­©å­çš„æƒ…æ„Ÿéœ€æ±‚');
            }
            
            if (bigFiveResult.å°½è´£æ€§ >= 4) {
                focus.push('å…è®¸å­©å­æœ‰æ¢ç´¢å’ŒçŠ¯é”™çš„ç©ºé—´');
            }
            
            if (bigFiveResult.æƒ…ç»ªç¨³å®šæ€§ <= 3) {
                focus.push('ä¿æŒæƒ…ç»ªç¨³å®š');
            }
            
            if (bigFiveResult.å¼€æ”¾æ€§ <= 3) {
                focus.push('æ¥å—å­©å­çš„æ–°æƒ³æ³•');
            }
            
            if (focus.length === 0) {
                focus.push('ç»§ç»­ä¿æŒå½“å‰çš„æ•™è‚²æ–¹å¼');
            }
            
            return focus.join('å’Œ');
        }

        // é‡ç½®æµ‹è¯•ï¼Œæ¸…é™¤ä¿å­˜çš„è§’è‰²
        window.resetTest = function() {
            // æ¸…é™¤localStorageä¸­ä¿å­˜çš„è§’è‰²
            localStorage.removeItem('selectedRole');
            
            // é‡ç½®UIçŠ¶æ€
            document.getElementById('roleSelection').style.display = 'flex';
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
            
            // é‡ç½®å…¶ä»–çŠ¶æ€
            window.currentRole = null;
            window.currentSection = null;
            window.currentQuestionIndex = 0;
            window.answers = {
                mbti: [],
                disc: [],
                bigFive: []
            };
        };
    </script>
</body>
</html> 
    <script>
        // ... existing code ...

        // å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨æµ‹è¯•ç»“æœ
        let testResults = {}; 

        // ... existing code ...

        // è®¡ç®—æµ‹è¯•ç»“æœ
        window.calculateResults = function() {
            console.log("å¼€å§‹è®¡ç®—æµ‹è¯•ç»“æœ...");
            console.log("ç”¨æˆ·ç­”æ¡ˆ:", window.answers);

            // --- MBTI è®¡ç®— ---
            let mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            const mbtiQuestions = window.questionBank[window.currentRole].mbti;
            for (let i = 0; i < mbtiQuestions.length; i++) {
                const answerIndex = window.answers.mbti[i];
                if (answerIndex !== undefined && mbtiQuestions[i].options[answerIndex]) {
                    const dimension = mbtiQuestions[i].options[answerIndex].dimension;
                    if (dimension && mbtiScores.hasOwnProperty(dimension)) {
                        mbtiScores[dimension]++;
                    }
                }
            }
            let mbtiType = "";
            mbtiType += (mbtiScores.E >= mbtiScores.I) ? 'E' : 'I';
            mbtiType += (mbtiScores.S >= mbtiScores.N) ? 'S' : 'N';
            mbtiType += (mbtiScores.T >= mbtiScores.F) ? 'T' : 'F';
            mbtiType += (mbtiScores.J >= mbtiScores.P) ? 'J' : 'P';
            console.log("MBTI åˆ†æ•°:", mbtiScores);
            console.log("MBTI ç±»å‹:", mbtiType);


            // --- DISC è®¡ç®— ---
            let discScores = { D: 0, I: 0, S: 0, C: 0 };
            const discQuestions = window.questionBank[window.currentRole].disc;
            for (let i = 0; i < discQuestions.length; i++) {
                const answerIndex = window.answers.disc[i];
                 if (answerIndex !== undefined && discQuestions[i].options[answerIndex]) {
                    const dimension = discQuestions[i].options[answerIndex].dimension;
                     if (dimension && discScores.hasOwnProperty(dimension)) {
                        discScores[dimension]++;
                    }
                }
            }
             // ç®€å•çš„ DISC ä¸»å¯¼ç±»å‹ç¡®å®šï¼ˆå¯ä»¥æ ¹æ®éœ€è¦å®ç°æ›´å¤æ‚çš„é€»è¾‘ï¼‰
            let dominantDisc = Object.keys(discScores).reduce((a, b) => discScores[a] > discScores[b] ? a : b);
            console.log("DISC åˆ†æ•°:", discScores);
            console.log("DISC ä¸»å¯¼ç±»å‹:", dominantDisc);


            // --- å¤§äº”äººæ ¼è®¡ç®— ---
            let bigFiveScores = { O: 0, C: 0, E: 0, A: 0, N: 0 };
            const bigFiveQuestions = window.questionBank[window.currentRole].bigFive;
            for (let i = 0; i < bigFiveQuestions.length; i++) {
                const answerValue = window.answers.bigFive[i]; // åˆ†æ•° 1-5
                if (answerValue !== undefined) {
                    const dimension = bigFiveQuestions[i].dimension;
                    const reversed = bigFiveQuestions[i].reversed || false;
                    let score = answerValue;
                    // å¤„ç†åå‘è®¡åˆ†é¢˜
                    if (reversed) {
                        score = 6 - answerValue;
                    }
                    if (dimension && bigFiveScores.hasOwnProperty(dimension)) {
                        bigFiveScores[dimension] += score;
                    }
                }
            }
             // å¯ä»¥å°†åŸå§‹åˆ†æ•°è½¬æ¢ä¸ºç™¾åˆ†æ¯”æˆ–å…¶ä»–æ ‡å‡†åŒ–åˆ†æ•°
            console.log("å¤§äº”äººæ ¼åŸå§‹åˆ†æ•°:", bigFiveScores);


            // å°†è®¡ç®—ç»“æœå­˜å‚¨åœ¨å…¨å±€å˜é‡ä¸­
            testResults = {
                mbti: { type: mbtiType, scores: mbtiScores },
                disc: { dominant: dominantDisc, scores: discScores },
                bigFive: { scores: bigFiveScores }
            };

            console.log("è®¡ç®—å®Œæˆçš„æµ‹è¯•ç»“æœ:", testResults);
            return testResults; // è¿”å›è®¡ç®—ç»“æœ
        };


        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        window.showResults = function() {
            console.log("å¼€å§‹æ˜¾ç¤ºæµ‹è¯•ç»“æœ...");
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';

            // é¦–å…ˆè®¡ç®—ç»“æœ
            const results = calculateResults(); // è°ƒç”¨è®¡ç®—å‡½æ•°è·å–åŠ¨æ€ç»“æœ

            if (!results) {
                console.error("æ— æ³•è·å–è®¡ç®—ç»“æœï¼");
                alert("è®¡ç®—ç»“æœæ—¶å‡ºé”™ï¼Œè¯·é‡è¯•ã€‚");
                return;
            }
             console.log("ç”¨äºæ˜¾ç¤ºçš„ç»“æœ:", results);


            // --- æ˜¾ç¤º MBTI ç»“æœ ---
            const mbtiResultContainer = document.getElementById('mbtiResult');
            mbtiResultContainer.innerHTML = ''; // æ¸…ç©ºæ—§å†…å®¹
            if (results.mbti && results.mbti.type) {
                 const mbtiData = window.personalityDescriptions.mbti[results.mbti.type];
                 if (mbtiData) {
                    mbtiResultContainer.innerHTML = `
                        <div class="role-title-result">
                            <span class="role-icon">${window.currentRole === 'child' ? 'ğŸ‘¶' : 'ğŸ‘¨â€ğŸ‘©'}</span>
                            æ‚¨çš„ MBTI ç±»å‹: <span class="mbti-type">${results.mbti.type} (${mbtiData.name})</span>
                        </div>
                        <p class="mbti-description">${mbtiData.description}</p>
                        <div class="mbti-details">
                            <p class="mbti-trait"><strong>ä¼˜åŠ¿:</strong> ${mbtiData.strengths.join(', ')}</p>
                            <p class="mbti-trait"><strong>å‘å±•å»ºè®®:</strong> ${mbtiData.weaknesses.join(', ')}</p>
                        </div>
                    `;
                } else {
                     mbtiResultContainer.textContent = `è®¡ç®—å‡ºçš„ MBTI ç±»å‹: ${results.mbti.type} (æè¿°ä¿¡æ¯æœªæ‰¾åˆ°)`;
                }
            } else {
                mbtiResultContainer.textContent = 'æœªèƒ½è®¡ç®—å‡º MBTI ç±»å‹ã€‚';
            }


            // --- æ˜¾ç¤º DISC ç»“æœ (ç¤ºä¾‹ï¼šç®€å•æ–‡æœ¬ï¼Œå¯ä»¥æ›¿æ¢ä¸ºå›¾è¡¨) ---
            const discSection = document.getElementById('discSection');
             const discChartContainer = document.getElementById('discChart');
             discChartContainer.innerHTML = ''; // æ¸…ç©ºæ—§å†…å®¹
             if (results.disc && results.disc.scores) {
                 // è¿™é‡Œå¯ä»¥æ·»åŠ ç»˜åˆ¶ DISC å›¾è¡¨çš„ä»£ç  (ä¾‹å¦‚ä½¿ç”¨ Chart.js)
                 // æš‚æ—¶ç”¨æ–‡æœ¬æ˜¾ç¤ºåˆ†æ•°
                 let discText = '<h3>DISC åˆ†æ•°:</h3><ul>';
                 for (const [key, value] of Object.entries(results.disc.scores)) {
                     discText += `<li>${key}: ${value}</li>`;
                 }
                 discText += '</ul>';
                 discChartContainer.innerHTML = discText;

                 // æ·»åŠ  DISC æè¿°
                 const discDesc = window.personalityDescriptions.disc[results.disc.dominant];
                 if(discDesc) {
                     const descElement = document.createElement('div');
                     descElement.className = 'disc-description';
                     descElement.innerHTML = `
                         <p><strong>æ‚¨çš„ä¸»å¯¼è¡Œä¸ºé£æ ¼: ${results.disc.dominant} (${discDesc.name})</strong></p>
                         <p>${discDesc.description}</p>
                     `;
                     // å°†æè¿°æ·»åŠ åˆ° DISC Sectionï¼Œè€Œä¸æ˜¯ Chart å®¹å™¨
                     // ç¡®ä¿åªæ·»åŠ ä¸€æ¬¡
                     const existingDesc = discSection.querySelector('.disc-description');
                     if (existingDesc) {
                         existingDesc.remove();
                     }
                     discSection.appendChild(descElement);
                 }

             } else {
                 discChartContainer.textContent = 'æœªèƒ½è®¡ç®—å‡º DISC åˆ†æ•°ã€‚';
             }


            // --- æ˜¾ç¤ºå¤§äº”äººæ ¼ç»“æœ (ç¤ºä¾‹ï¼šè¿›åº¦æ¡) ---
            const bigFiveSection = document.getElementById('bigFiveSection');
            const bigFiveChartContainer = document.getElementById('bigFiveChart');
            bigFiveChartContainer.innerHTML = ''; // æ¸…ç©ºæ—§å†…å®¹
            if (results.bigFive && results.bigFive.scores) {
                const bigFiveMapping = { O: 'å¼€æ”¾æ€§ (Openness)', C: 'å°½è´£æ€§ (Conscientiousness)', E: 'å¤–å‘æ€§ (Extraversion)', A: 'å®œäººæ€§ (Agreeableness)', N: 'ç¥ç»è´¨æ€§ (Neuroticism)' };
                // å‡è®¾æ¯ä¸ªç»´åº¦çš„æœ€é«˜å¯èƒ½åŸå§‹åˆ†æ˜¯ 5 * (é¢˜ç›®æ•° / 5)
                // éœ€è¦æ ¹æ®å®é™…é¢˜ç›®æ•°é‡è°ƒæ•´æœ€å¤§å€¼
                const maxScorePerDimension = 5 * (window.questionBank[window.currentRole].bigFive.length / 5); // ç²—ç•¥ä¼°è®¡

                for (const [key, value] of Object.entries(results.bigFive.scores)) {
                    const percentage = Math.max(0, Math.min(100, Math.round((value / maxScorePerDimension) * 100))); // è½¬æ¢ä¸ºç™¾åˆ†æ¯”
                    const traitBar = document.createElement('div');
                    traitBar.className = 'trait-bar';
                    traitBar.innerHTML = `
                        <div class="trait-label">${bigFiveMapping[key] || key}</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${percentage}%;"></div>
                        </div>
                        <div class="trait-value">${percentage}%</div>
                    `;
                    bigFiveChartContainer.appendChild(traitBar);
                }

                 // æ·»åŠ å¤§äº”äººæ ¼æ•´ä½“æè¿°ï¼ˆå¦‚æœéœ€è¦ï¼‰
                 const big5DescElement = document.createElement('div');
                 big5DescElement.className = 'big5-description';
                 // å¯ä»¥æ ¹æ®åˆ†æ•°é«˜ä½ç»„åˆç”Ÿæˆæè¿°
                 big5DescElement.innerHTML = `<p>ä»¥ä¸Šæ˜¯å¤§äº”äººæ ¼å„ç»´åº¦çš„å¾—åˆ†æƒ…å†µã€‚</p>`;
                 // ç¡®ä¿åªæ·»åŠ ä¸€æ¬¡
                 const existingDesc = bigFiveSection.querySelector('.big5-description');
                 if (existingDesc) {
                     existingDesc.remove();
                 }
                 bigFiveSection.appendChild(big5DescElement);

            } else {
                bigFiveChartContainer.textContent = 'æœªèƒ½è®¡ç®—å‡ºå¤§äº”äººæ ¼åˆ†æ•°ã€‚';
            }

            // --- æ˜¾ç¤ºæ²Ÿé€šå»ºè®® ---
            const tipsContainer = document.getElementById('communicationTips');
            tipsContainer.innerHTML = ''; // æ¸…ç©ºæ—§å†…å®¹
            // åŸºäºè®¡ç®—å‡ºçš„ç»“æœç”Ÿæˆæ²Ÿé€šå»ºè®®
            // è¿™æ˜¯ä¸€ä¸ªå¤æ‚é€»è¾‘ï¼Œéœ€è¦ç»“åˆå®¶é•¿å’Œå­©å­çš„æµ‹è¯•ç»“æœ
            // æš‚æ—¶ç•™ç©ºæˆ–æ˜¾ç¤ºé€šç”¨æç¤º
            tipsContainer.innerHTML = `
                <h3>æ²Ÿé€šå»ºè®®</h3>
                <p>ï¼ˆè¿™é‡Œå°†æ ¹æ®æ‚¨å’Œå­©å­çš„æ€§æ ¼æµ‹è¯•ç»“æœç”Ÿæˆä¸ªæ€§åŒ–çš„æ²Ÿé€šå»ºè®®ï¼‰</p>
                <p>è¯·ç‚¹å‡»â€œå¼€å§‹å¯¹è¯â€å°†æµ‹è¯•ç»“æœå‘é€ç»™ AIï¼Œè·å–æ›´è¯¦ç»†çš„åˆ†æå’Œå»ºè®®ã€‚</p>
            `;


            console.log("ç»“æœæ˜¾ç¤ºå®Œæˆã€‚");
        };

        // å¼€å§‹å¯¹è¯æŒ‰é’®çš„é€»è¾‘
        window.startChatWithAlert = function() {
            console.log("ç‚¹å‡»äº†å¼€å§‹å¯¹è¯æŒ‰é’®");
            // ç¡®ä¿ç»“æœå·²ç»è®¡ç®—å¹¶å­˜å‚¨åœ¨ testResults ä¸­
            if (!testResults || Object.keys(testResults).length === 0) {
                 console.warn("æµ‹è¯•ç»“æœå°šæœªè®¡ç®—æˆ–ä¸ºç©ºï¼Œå°è¯•é‡æ–°è®¡ç®—...");
                 calculateResults(); // å°è¯•å†æ¬¡è®¡ç®—
                 if (!testResults || Object.keys(testResults).length === 0) {
                     alert("æ— æ³•è·å–æµ‹è¯•ç»“æœï¼Œè¯·å…ˆå®Œæˆæµ‹è¯•ã€‚");
                     console.error("æ— æ³•è·å–æˆ–è®¡ç®—æµ‹è¯•ç»“æœã€‚");
                     return;
                 }
            }

            try {
                // å°†æœ€ç»ˆç»“æœä¿å­˜åˆ° localStorage
                localStorage.setItem('personalityResults', JSON.stringify(testResults));
                localStorage.setItem('selectedRole', window.currentRole); // ç¡®ä¿å­˜å‚¨äº†è§’è‰²
                console.log("æµ‹è¯•ç»“æœå·²ä¿å­˜åˆ° localStorage:", testResults);

                // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                alert("å·²ç»æŠŠæµ‹è¯•ç»“æœæäº¤ç»™AIä»¥ä¾¿äºæ›´å¥½çš„é’ˆå¯¹æ€§çš„æå»ºè®®");

                // è·³è½¬åˆ°èŠå¤©é¡µé¢
                window.location.href = 'chat.html';
            } catch (error) {
                console.error("ä¿å­˜ç»“æœæˆ–è·³è½¬æ—¶å‡ºé”™:", error);
                alert("å¤„ç†ç»“æœæ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚");
            }
        };

        // ä¿®æ”¹â€œå¼€å§‹å¯¹è¯â€æŒ‰é’®çš„ onclick äº‹ä»¶
        // åœ¨ HTML ä¸­æ‰¾åˆ°è¿™ä¸ªæŒ‰é’®å¹¶ç¡®ä¿å®ƒè°ƒç”¨çš„æ˜¯ startChatWithAlert()
        // <button class="nav-button" onclick="startChatWithAlert()">å¼€å§‹å¯¹è¯</button>


        // ... a lot of existing code ...

        // é‡ç½®æµ‹è¯•
        window.resetTest = function() {
            console.log("é‡ç½®æµ‹è¯•...");
            // æ¸…é™¤ç­”æ¡ˆå’ŒçŠ¶æ€
            window.currentSection = 'mbti';
            window.currentQuestionIndex = 0;
            window.answers = { mbti: [], disc: [], bigFive: [] };
            testResults = {}; // æ¸…ç©ºå…¨å±€ç»“æœå˜é‡
            localStorage.removeItem('personalityResults'); // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ç»“æœ
            localStorage.removeItem('selectedRole'); // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„è§’è‰²

            // éšè—ç»“æœï¼Œæ˜¾ç¤ºè§’è‰²é€‰æ‹©
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('roleSelection').style.display = 'flex'; // æ˜¾ç¤ºè§’è‰²é€‰æ‹©

            // é‡ç½®è¿›åº¦æ¡
            document.getElementById('progressBar').style.width = '0%';
            console.log("æµ‹è¯•å·²é‡ç½®ã€‚");
        };

        // ... existing code ...

    </script>
</body>
</html>