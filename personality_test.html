<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫≤Â≠êÊÄßÊ†ºÂåπÈÖçÂàÜÊûê - Âíå‰∫ãÂÆù</title>
    <script src="personality_questions.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #f5f7fa;
            --text-color: #2c3e50;
            --border-radius: 15px;
            --shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: SimSun, 'ÂÆã‰Ωì', serif;
            background: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .test-header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease;
        }

        .test-header h1 {
            font-size: 2rem;
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .test-header p {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 2rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
            width: 0%;
        }

        .question-container {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .option.selected {
            border-color: var(--primary-color);
            background: rgba(52, 152, 219, 0.1);
        }

        .scale-container {
            margin-top: 2rem;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .scale-buttons {
            display: flex;
            justify-content: space-between;
        }

        .scale-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e0e0e0;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scale-button:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .scale-button.selected {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding: 0 1rem;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .likert-radio {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .likert-radio:checked {
            border-color: var(--primary-color);
            background: var(--primary-color);
        }

        .likert-label {
            font-size: 0.9rem;
            color: #666;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .nav-button {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            background: var(--primary-color);
            color: white;
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-button:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .back-button {
            background: #95a5a6;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .role-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 3rem 0;
            animation: fadeInUp 0.8s ease;
        }

        .role-cards {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* ËßíËâ≤ÈÄâÊã©È°µÈù¢Â∫ïÈÉ®ÊèêÁ§∫‰ø°ÊÅØÊ†∑Âºè */
        .bottom-selector-info {
            margin-top: 2rem;
            text-align: center;
            color: #666;
            animation: pulse 2s infinite;
        }

        .bottom-selector-info p {
            font-size: 1.1rem;
            position: relative;
            display: inline-block;
        }

        .bottom-selector-info p:before,
        .bottom-selector-info p:after {
            content: 'üëÜ';
            position: absolute;
            top: -1.5rem;
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .bottom-selector-info p:before {
            left: 25%;
            transform: translateX(-50%);
        }

        .bottom-selector-info p:after {
            right: 25%;
            transform: translateX(50%);
        }

        @keyframes pulse {
            0% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.7;
            }
        }

        .role-card {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 200px;
        }

        .role-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .role-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .role-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .role-description {
            font-size: 0.9rem;
            color: #666;
        }

        .results-container {
            display: none;
            animation: fadeInUp 0.8s ease;
        }

        .results-section {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .results-chart {
            margin: 2rem 0;
            height: 300px;
        }

        .trait-bar {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .trait-label {
            width: 120px;
            font-size: 0.9rem;
        }

        .trait-progress {
            flex-grow: 1;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .trait-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 1s ease;
        }

        .trait-value {
            width: 50px;
            text-align: right;
            font-size: 0.9rem;
            margin-left: 1rem;
        }

        .role-title-result {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .role-icon {
            font-size: 2rem;
            margin-right: 0.5rem;
        }

        .mbti-type {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .mbti-description {
            font-size: 1rem;
            color: #666;
        }

        .mbti-details {
            margin-top: 0.5rem;
        }

        .mbti-trait {
            margin-bottom: 0.25rem;
        }

        .disc-description {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .big5-description {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .communicationTips {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-header">
            <h1>‰∫≤Â≠êÊÄßÊ†ºÂåπÈÖçÂàÜÊûê</h1>
            <p>ÈÄöËøáÁßëÂ≠¶ÁöÑÊÄßÊ†ºÊµãËØÑÔºåÂ∏ÆÂä©ÊÇ®Êõ¥Â•ΩÂú∞ÁêÜËß£ÂΩºÊ≠§ÔºåÊèêÂçáÊ≤üÈÄöÊïàÊûú</p>
        </div>

        <div id="roleSelection" class="role-selection">
            <div class="role-cards">
                <div class="role-card" onclick="startTest('child')">
                    <div class="role-icon">üë∂</div>
                    <div class="role-title">ÊàëÊòØÂ≠©Â≠ê</div>
                    <div class="role-description">ÈÄÇÂêà6-15Â≤ÅÁöÑÈùíÂ∞ëÂπ¥ÔºåÂ∏ÆÂä©‰∫ÜËß£Ëá™Â∑±ÁöÑÊÄßÊ†ºÁâπÁÇπ</div>
                </div>
                <div class="role-card" onclick="startTest('parent')">
                    <div class="role-icon">üë®‚Äçüë©</div>
                    <div class="role-title">ÊàëÊòØÂÆ∂Èïø</div>
                    <div class="role-description">ÈÄÇÂêàÂÆ∂ÈïøÔºå‰∫ÜËß£Ëá™Â∑±ÁöÑÊïôËÇ≤È£éÊ†º‰∏éÊ≤üÈÄöÊñπÂºè</div>
                </div>
            </div>

            <!-- Âú®ËßíËâ≤ÈÄâÊã©È°µÈù¢Â∫ïÈÉ®Ê∑ªÂä†ÂàáÊç¢ÂäüËÉΩ -->
            <div class="bottom-selector-info">
                <p>ËØ∑ÈÄâÊã©ÊÇ®ÁöÑËßíËâ≤ÂºÄÂßãÊµãËØï</p>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="question-container" id="questionContainer" style="display: none;">
            <h2 id="questionTitle"></h2>
            <div class="question-text" id="questionText"></div>
            <div class="options-container" id="optionsContainer"></div>
            <div class="navigation-buttons">
                <button class="nav-button back-button" id="prevButton" onclick="previousQuestion()">‰∏ä‰∏ÄÈ¢ò</button>
                <button class="nav-button" id="nextButton" onclick="nextQuestion()">‰∏ã‰∏ÄÈ¢ò</button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer" style="display: none;">
            <div class="results-section">
                <h2 class="results-title">MBTI ÊÄßÊ†ºÁ±ªÂûã</h2>
                <div id="mbtiResult"></div>
            </div>
            <div class="results-section" id="discSection">
                <h2 class="results-title">DISC Ë°å‰∏∫È£éÊ†º</h2>
                <div class="results-chart" id="discChart"></div>
            </div>
            <div class="results-section" id="bigFiveSection">
                <h2 class="results-title">Â§ß‰∫î‰∫∫Ê†ºÁâπË¥®</h2>
                <div class="results-chart" id="bigFiveChart"></div>
            </div>
            <div class="results-section">
                <div id="communicationTips"></div>
            </div>
            <div class="navigation-buttons">
                <button class="nav-button back-button" onclick="resetTest()">ÈáçÊñ∞ÊµãËØï</button>
                <button class="nav-button" onclick="window.location.href='chat.html'">ÂºÄÂßãÂØπËØù</button>
            </div>
        </div>
    </div>

    <script>
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log("È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÂàùÂßãÂåñÊµãËØï...");
                
                // ÂàùÂßãÂåñÈóÆÈ¢òÂ∫ì
                if (typeof questionBank === 'undefined') {
                    console.error("ÈóÆÈ¢òÂ∫ìÊú™Âä†ËΩΩ!");
                    alert("ÈóÆÈ¢òÂ∫ìÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï");
                    return;
                }
                console.log("ÈóÆÈ¢òÂ∫ìÂä†ËΩΩÂÆåÊàê:", questionBank);
                
                // ËÆæÁΩÆÂÖ®Â±ÄËÆøÈóÆÂèòÈáè
                window.questionBank = questionBank;
                
                // ÊòæÁ§∫ËßíËâ≤ÈÄâÊã©ÁïåÈù¢ÔºåËÄå‰∏çÊòØÁõ¥Êé•ÂºÄÂßãÊµãËØï
                document.getElementById('roleSelection').style.display = 'flex';
                document.getElementById('questionContainer').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'none';
                
            } catch (error) {
                console.error("ÂàùÂßãÂåñÊµãËØïÊó∂Âá∫Èîô:", error);
            }
        });

        // ÂºÄÂßãÊµãËØï
        window.startTest = function(role) {
            console.log("ÂêØÂä®ÊµãËØïÔºåËßíËâ≤:", role);
            
            // ËÆæÁΩÆËßíËâ≤Âπ∂‰øùÂ≠òÂà∞localStorage
            window.currentRole = role;
            localStorage.setItem('selectedRole', role);
            
            // ÂàùÂßãÂåñÊµãËØïÁä∂ÊÄÅ
            window.currentSection = 'mbti';
            window.currentQuestionIndex = 0;
            window.answers = {
                mbti: [],
                disc: [],
                bigFive: []
            };

            // ÈöêËóèËßíËâ≤ÈÄâÊã©ÁïåÈù¢ÔºåÊòæÁ§∫ÈóÆÈ¢ò
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'block';
            
            // ÊòæÁ§∫Á¨¨‰∏Ä‰∏™ÈóÆÈ¢ò
            showQuestion();
        };

        // ÊòæÁ§∫ÂΩìÂâçÈóÆÈ¢ò
        window.showQuestion = function() {
            try {
                const question = getCurrentQuestion();
                
                if (!question) {
                    console.error("Êó†Ê≥ïËé∑ÂèñÂΩìÂâçÈóÆÈ¢ò");
                    return;
                }
                
                console.log("Ê≠£Âú®ÊòæÁ§∫ÈóÆÈ¢ò:", question);
                
                // Êõ¥Êñ∞ËøõÂ∫¶Êù°
                const totalQuestions = 
                    window.questionBank[window.currentRole].mbti.length + 
                    window.questionBank[window.currentRole].disc.length + 
                    window.questionBank[window.currentRole].bigFive.length;
                
                let completedQuestions = window.currentQuestionIndex;
                
                if (window.currentSection === 'disc') {
                    completedQuestions += window.questionBank[window.currentRole].mbti.length;
                } else if (window.currentSection === 'bigFive') {
                    completedQuestions += 
                        window.questionBank[window.currentRole].mbti.length + 
                        window.questionBank[window.currentRole].disc.length;
                }
                
                const progress = Math.floor((completedQuestions / totalQuestions) * 100);
                document.getElementById('progressBar').style.width = `${progress}%`;
                
                // Êõ¥Êñ∞ÈóÆÈ¢òÊ†áÈ¢ò
                let sectionTitle = '';
                if (window.currentSection === 'mbti') {
                    sectionTitle = 'MBTIÊÄßÊ†ºÊµãËØï';
                } else if (window.currentSection === 'disc') {
                    sectionTitle = 'DISCË°å‰∏∫È£éÊ†º';
                } else if (window.currentSection === 'bigFive') {
                    sectionTitle = 'Â§ß‰∫î‰∫∫Ê†ºÊµãËØï';
                }
                
                document.getElementById('questionTitle').textContent = sectionTitle;
                
                // ÊòæÁ§∫ÈóÆÈ¢òÊñáÊú¨
                const questionText = document.getElementById('questionText');
                questionText.textContent = question.question;
                
                // Ê∏ÖÈô§‰πãÂâçÁöÑÈÄâÈ°π
                const optionsContainer = document.getElementById('optionsContainer');
                optionsContainer.innerHTML = '';
                
                // Ê∑ªÂä†Êñ∞ÈÄâÈ°π
                if (window.currentSection === 'bigFive') {
                    // ÂàõÂª∫Â§ß‰∫î‰∫∫Ê†ºÁöÑÈáèË°®ÈÄâÈ°π
                    const scaleContainer = document.createElement('div');
                    scaleContainer.className = 'scale-container';
                    
                    // Ê∑ªÂä†ÈáèË°®Ê†áÁ≠æ
                    const labelsContainer = document.createElement('div');
                    labelsContainer.className = 'scale-labels';
                    
                    const leftLabel = document.createElement('span');
                    leftLabel.textContent = 'ÂÆåÂÖ®‰∏çÂêåÊÑè';
                    
                    const rightLabel = document.createElement('span');
                    rightLabel.textContent = 'ÂÆåÂÖ®ÂêåÊÑè';
                    
                    labelsContainer.appendChild(leftLabel);
                    labelsContainer.appendChild(rightLabel);
                    scaleContainer.appendChild(labelsContainer);
                    
                    // Ê∑ªÂä†ÈáèË°®ÊåâÈíÆ
                    const buttonsContainer = document.createElement('div');
                    buttonsContainer.className = 'scale-buttons';
                    
                    for (let i = 1; i <= 5; i++) {
                        const button = document.createElement('button');
                        button.className = 'scale-button';
                        button.setAttribute('data-value', i);
                        button.textContent = i;
                        
                        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÈÄâÊã©
                        if (window.answers[window.currentSection][window.currentQuestionIndex] === i) {
                            button.classList.add('selected');
                        }
                        
                        button.onclick = function() {
                            selectOption(i);
                        };
                        
                        buttonsContainer.appendChild(button);
                    }
                    
                    scaleContainer.appendChild(buttonsContainer);
                    optionsContainer.appendChild(scaleContainer);
                } else {
                    // ÂàõÂª∫MBTIÊàñDISCÁöÑÈÄâÈ°π
                    for (let i = 0; i < question.options.length; i++) {
                        const option = document.createElement('div');
                        option.className = 'option';
                        
                        // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÈÄâÊã©
                        if (window.answers[window.currentSection][window.currentQuestionIndex] === i) {
                            option.classList.add('selected');
                        }
                        
                        option.onclick = function() {
                            selectOption(i);
                        };
                        
                        const optionText = document.createElement('p');
                        optionText.textContent = question.options[i].text;
                        option.appendChild(optionText);
                        
                        optionsContainer.appendChild(option);
                    }
                }
                
                // Êõ¥Êñ∞ÂØºËà™ÊåâÈíÆ
                const prevButton = document.getElementById('prevButton');
                const nextButton = document.getElementById('nextButton');
                
                // Á¨¨‰∏Ä‰∏™ÈóÆÈ¢òÊ≤°Êúâ‰∏ä‰∏ÄÈ¢òÊåâÈíÆ
                if (window.currentSection === 'mbti' && window.currentQuestionIndex === 0) {
                    prevButton.style.visibility = 'hidden';
                } else {
                    prevButton.style.visibility = 'visible';
                }
                
                // ÊúÄÂêé‰∏Ä‰∏™ÈóÆÈ¢òÊòæÁ§∫ÂÆåÊàêÊåâÈíÆ
                if (window.currentSection === 'bigFive' && 
                    window.currentQuestionIndex === window.questionBank[window.currentRole].bigFive.length - 1) {
                    nextButton.textContent = 'ÂÆåÊàêÊµãËØï';
                } else {
                    nextButton.textContent = '‰∏ã‰∏ÄÈ¢ò';
                }
            } catch (error) {
                console.error("ÊòæÁ§∫ÈóÆÈ¢òÊó∂Âá∫Èîô:", error);
            }
        };

        // Ëé∑ÂèñÂΩìÂâçÈóÆÈ¢ò
        window.getCurrentQuestion = function() {
            console.log("Ëé∑ÂèñÈóÆÈ¢ò - ËßíËâ≤:", window.currentRole, "ÈÉ®ÂàÜ:", window.currentSection, "Á¥¢Âºï:", window.currentQuestionIndex);
            
            try {
                // Ê£ÄÊü•ÈóÆÈ¢òÂ∫ìÊòØÂê¶Â≠òÂú®
                if (!window.questionBank) {
                    console.error("ÈóÆÈ¢òÂ∫ìÊú™ÂÆö‰πâ!");
                    return null;
                }
                
                // Ê£ÄÊü•ËßíËâ≤ÊòØÂê¶ÊúâÊïà
                if (!window.questionBank[window.currentRole]) {
                    console.error("Êó†ÊïàÁöÑËßíËâ≤:", window.currentRole);
                    console.log("ÂèØÁî®ËßíËâ≤:", Object.keys(window.questionBank));
                    return null;
                }
                
                // Ê£ÄÊü•ÊµãËØïÈÉ®ÂàÜÊòØÂê¶ÊúâÊïà
                if (!window.questionBank[window.currentRole][window.currentSection]) {
                    console.error("Êó†ÊïàÁöÑÊµãËØïÈÉ®ÂàÜ:", window.currentSection);
                    console.log("ÂèØÁî®ÈÉ®ÂàÜ:", Object.keys(window.questionBank[window.currentRole]));
                    return null;
                }
                
                // Ëé∑ÂèñÂΩìÂâçÈÉ®ÂàÜÁöÑÈóÆÈ¢ò
                const questions = window.questionBank[window.currentRole][window.currentSection];
                
                // Ê£ÄÊü•ÈóÆÈ¢òÁ¥¢ÂºïÊòØÂê¶ÊúâÊïà
                if (window.currentQuestionIndex < 0 || window.currentQuestionIndex >= questions.length) {
                    console.error("Êó†ÊïàÁöÑÈóÆÈ¢òÁ¥¢Âºï:", window.currentQuestionIndex, "ÈóÆÈ¢òÊï∞Èáè:", questions.length);
                    return null;
                }
                
                return questions[window.currentQuestionIndex];
            } catch (error) {
                console.error("Ëé∑ÂèñÈóÆÈ¢òÊó∂Âá∫Èîô:", error);
                return null;
            }
        };

        // ÈÄâÊã©ÈÄâÈ°π
        window.selectOption = function(optionIndex) {
            try {
                const question = getCurrentQuestion();
                if (!question) {
                    console.error("Êó†Ê≥ïËé∑ÂèñÂΩìÂâçÈóÆÈ¢ò");
                    return;
                }
                
                console.log("ÈÄâÊã©ÈÄâÈ°π", optionIndex, "ÂØπ‰∫éÈóÆÈ¢ò", question.question);
                
                // ÁÆÄÂåñÁ≠îÊ°àËÆ∞ÂΩïÔºåÂè™Â≠òÂÇ®Á¥¢Âºï
                window.answers[window.currentSection][window.currentQuestionIndex] = optionIndex;
                
                // Êõ¥Êñ∞UIÊòæÁ§∫Â∑≤ÈÄâÊã©ÁöÑÈÄâÈ°π
                const optionsContainer = document.getElementById('optionsContainer');
                
                if (window.currentSection === 'bigFive') {
                    // Â§ß‰∫î‰∫∫Ê†ºÁöÑÈáèË°®ÈÄâÈ°π
                    const scaleButtons = optionsContainer.querySelectorAll('.scale-button');
                    scaleButtons.forEach(button => {
                        if (parseInt(button.getAttribute('data-value')) === optionIndex) {
                            button.classList.add('selected');
                        } else {
                            button.classList.remove('selected');
                        }
                    });
                } else {
                    // MBTIÂíåDISCÁöÑÈÄâÈ°π
                    const options = optionsContainer.querySelectorAll('.option');
                    options.forEach((option, idx) => {
                        if (idx === optionIndex) {
                            option.classList.add('selected');
                        } else {
                            option.classList.remove('selected');
                        }
                    });
                }
                
                // Ëá™Âä®ÂâçËøõÂà∞‰∏ã‰∏ÄÈ¢ò
                setTimeout(() => {
                    nextQuestion();
                }, 500);
            } catch (error) {
                console.error("ÈÄâÊã©ÈÄâÈ°πÊó∂Âá∫Èîô:", error);
            }
        };

        // ‰∏ä‰∏ÄÈ¢ò
        window.previousQuestion = function() {
            try {
                if (window.currentQuestionIndex > 0) {
                    window.currentQuestionIndex--;
                } else if (window.currentSection === 'disc') {
                    window.currentSection = 'mbti';
                    window.currentQuestionIndex = window.questionBank[window.currentRole].mbti.length - 1;
                } else if (window.currentSection === 'bigFive') {
                    window.currentSection = 'disc';
                    window.currentQuestionIndex = window.questionBank[window.currentRole].disc.length - 1;
                }
                showQuestion();
            } catch (error) {
                console.error("ËøîÂõû‰∏ä‰∏ÄÈ¢òÊó∂Âá∫Èîô:", error);
            }
        };

        // ‰∏ã‰∏ÄÈ¢ò
        window.nextQuestion = function() {
            try {
                // Ëé∑ÂèñÂΩìÂâçÈÉ®ÂàÜÁöÑÈóÆÈ¢òÊï∞Èáè
                const currentSectionQuestions = window.questionBank[window.currentRole][window.currentSection];
                
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÂõûÁ≠îÂΩìÂâçÈóÆÈ¢ò
                if (window.answers[window.currentSection][window.currentQuestionIndex] === undefined) {
                    alert("ËØ∑ÂÖàÂõûÁ≠îÂΩìÂâçÈóÆÈ¢ò");
                    return;
                }
                
                if (window.currentQuestionIndex < currentSectionQuestions.length - 1) {
                    // ÂâçËøõÂà∞‰∏ã‰∏Ä‰∏™ÈóÆÈ¢ò
                    window.currentQuestionIndex++;
                    showQuestion();
                } else {
                    // ÂΩìÂâçÈÉ®ÂàÜÁöÑÈóÆÈ¢òÂ∑≤ÂÆåÊàêÔºåÁßªÂä®Âà∞‰∏ã‰∏ÄÈÉ®ÂàÜ
                    if (window.currentSection === 'mbti') {
                        window.currentSection = 'disc';
                        window.currentQuestionIndex = 0;
                        showQuestion();
                    } else if (window.currentSection === 'disc') {
                        window.currentSection = 'bigFive';
                        window.currentQuestionIndex = 0;
                        showQuestion();
                    } else {
                        // ÊâÄÊúâÈÉ®ÂàÜÈÉΩÂ∑≤ÂÆåÊàê
                        showResults();
                    }
                }
            } catch (error) {
                console.error("ÂâçËøõÂà∞‰∏ã‰∏ÄÈ¢òÊó∂Âá∫Èîô:", error);
                // Âá∫ÈîôÊó∂‰πüÂ∞ùËØïÊòæÁ§∫ÁªìÊûú
                showResults();
            }
        };

        // ÊòæÁ§∫ÁªìÊûú
        window.showResults = function() {
            try {
                console.log("ÊòæÁ§∫ÊµãËØïÁªìÊûú...");
                
                // ÈöêËóèÈóÆÈ¢òÂÆπÂô®ÔºåÊòæÁ§∫ÁªìÊûúÂÆπÂô®
                document.getElementById('questionContainer').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'block';
                
                // ÂàõÂª∫‰∏¥Êó∂ÁöÑÂàÜÊûêÁªìÊûúÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠ËøôÂ∫îËØ•Ë∞ÉÁî®personality_questions.js‰∏≠ÁöÑÂàÜÊûêÂáΩÊï∞Ôºâ
                // ÂÅáËÆæMBTIÂàÜÊûêÁªìÊûú
                const mbtiResult = {
                    EI: window.currentRole === 'child' ? 'I' : 'E',
                    SN: window.currentRole === 'child' ? 'N' : 'S',
                    TF: window.currentRole === 'child' ? 'F' : 'T',
                    JP: window.currentRole === 'child' ? 'P' : 'J'
                };
                
                // ÂÅáËÆæDISCÂàÜÊûêÁªìÊûú
                const discResult = {
                    D: window.currentRole === 'child' ? 65 : 75,
                    I: window.currentRole === 'child' ? 80 : 60,
                    S: window.currentRole === 'child' ? 50 : 65,
                    C: window.currentRole === 'child' ? 40 : 85
                };
                
                // ÂÅáËÆæÂ§ß‰∫î‰∫∫Ê†ºÂàÜÊûêÁªìÊûú
                const bigFiveResult = {
                    Â§ñÂêëÊÄß: window.currentRole === 'child' ? 3 : 4,
                    ÂÆú‰∫∫ÊÄß: window.currentRole === 'child' ? 4 : 3,
                    Â∞ΩË¥£ÊÄß: window.currentRole === 'child' ? 3 : 5,
                    ÊÉÖÁª™Á®≥ÂÆöÊÄß: window.currentRole === 'child' ? 2 : 4,
                    ÂºÄÊîæÊÄß: window.currentRole === 'child' ? 5 : 3
                };
                
                // ÊòæÁ§∫MBTIÁªìÊûú
                const mbtiResultContainer = document.getElementById('mbtiResult');
                
                let mbtiType = "";
                for (const dim in mbtiResult) {
                    mbtiType += mbtiResult[dim];
                }
                
                let mbtiDescription = getMBTIDescription(mbtiType);
                
                mbtiResultContainer.innerHTML = `
                    <div class="mbti-type">${mbtiType}</div>
                    <div class="mbti-description">${mbtiDescription}</div>
                    <div class="mbti-details">
                        <div class="mbti-trait">${mbtiResult.EI === 'E' ? 'Â§ñÂêëÂûã' : 'ÂÜÖÂêëÂûã'}: ${mbtiResult.EI === 'E' ? '‰ªéÂ§ñÈÉ®‰∏ñÁïåËé∑ÂèñËÉΩÈáè' : '‰ªéÂÜÖÂøÉ‰∏ñÁïåËé∑ÂèñËÉΩÈáè'}</div>
                        <div class="mbti-trait">${mbtiResult.SN === 'S' ? 'ÂÆûÊÑüÂûã' : 'Áõ¥ËßâÂûã'}: ${mbtiResult.SN === 'S' ? 'ÂÖ≥Ê≥®ÂÖ∑‰ΩìÁªÜËäÇÂíå‰∫ãÂÆû' : 'ÂÖ≥Ê≥®ÂèØËÉΩÊÄßÂíåÊ¶ÇÂøµ'}</div>
                        <div class="mbti-trait">${mbtiResult.TF === 'T' ? 'ÊÄùËÄÉÂûã' : 'ÊÉÖÊÑüÂûã'}: ${mbtiResult.TF === 'T' ? 'Âü∫‰∫éÈÄªËæëÂÅöÂÜ≥ÂÆö' : 'Âü∫‰∫é‰ª∑ÂÄºËßÇÂíåÊÉÖÊÑüÂÅöÂÜ≥ÂÆö'}</div>
                        <div class="mbti-trait">${mbtiResult.JP === 'J' ? 'Âà§Êñ≠Âûã' : 'ÊÑüÁü•Âûã'}: ${mbtiResult.JP === 'J' ? 'ÂñúÊ¨¢ËÆ°ÂàíÂíåÁªÑÁªá' : 'ÂñúÊ¨¢ÁÅµÊ¥ªÂíåËá™Âèë'}</div>
                    </div>
                `;
                
                // ÊòæÁ§∫DISCÁªìÊûú
                const discChartContainer = document.getElementById('discChart');
                
                const discBarChart = `
                    <div class="trait-bar">
                        <div class="trait-label">ÊîØÈÖçÊÄß (D)</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${discResult.D}%;"></div>
                        </div>
                        <div class="trait-value">${discResult.D}%</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">ÂΩ±ÂìçÊÄß (I)</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${discResult.I}%;"></div>
                        </div>
                        <div class="trait-value">${discResult.I}%</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">Á®≥ÂÆöÊÄß (S)</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${discResult.S}%;"></div>
                        </div>
                        <div class="trait-value">${discResult.S}%</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">Ë∞®ÊÖéÊÄß (C)</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${discResult.C}%;"></div>
                        </div>
                        <div class="trait-value">${discResult.C}%</div>
                    </div>
                    <div class="disc-description">
                        ${getDISCDescription(discResult)}
                    </div>
                `;
                
                discChartContainer.innerHTML = discBarChart;
                
                // ÊòæÁ§∫Â§ß‰∫î‰∫∫Ê†ºÁªìÊûú
                const bigFiveChartContainer = document.getElementById('bigFiveChart');
                
                const bigFiveBarChart = `
                    <div class="trait-bar">
                        <div class="trait-label">Â§ñÂêëÊÄß</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.Â§ñÂêëÊÄß * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.Â§ñÂêëÊÄß}</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">ÂÆú‰∫∫ÊÄß</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.ÂÆú‰∫∫ÊÄß * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.ÂÆú‰∫∫ÊÄß}</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">Â∞ΩË¥£ÊÄß</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.Â∞ΩË¥£ÊÄß * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.Â∞ΩË¥£ÊÄß}</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">ÊÉÖÁª™Á®≥ÂÆöÊÄß</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.ÊÉÖÁª™Á®≥ÂÆöÊÄß * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.ÊÉÖÁª™Á®≥ÂÆöÊÄß}</div>
                    </div>
                    <div class="trait-bar">
                        <div class="trait-label">ÂºÄÊîæÊÄß</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${bigFiveResult.ÂºÄÊîæÊÄß * 20}%;"></div>
                        </div>
                        <div class="trait-value">${bigFiveResult.ÂºÄÊîæÊÄß}</div>
                    </div>
                    <div class="big5-description">
                        ${getBigFiveDescription(bigFiveResult)}
                    </div>
                `;
                
                bigFiveChartContainer.innerHTML = bigFiveBarChart;
                
                // ÊòæÁ§∫Ê≤üÈÄöÂª∫ËÆÆ
                const communicationTips = document.getElementById('communicationTips');
                communicationTips.innerHTML = `
                    <h2 class="results-title">Ê≤üÈÄöÂª∫ËÆÆ</h2>
                    <p>${getCommunicationTips(window.currentRole, mbtiType, discResult, bigFiveResult)}</p>
                `;
                
                // ‰øùÂ≠òÊµãËØïÁªìÊûúÂà∞localStorage
                const testResults = {
                    role: window.currentRole,
                    mbti: mbtiType,
                    disc: discResult,
                    bigFive: bigFiveResult,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('personalityTestResults', JSON.stringify(testResults));
                
            } catch (error) {
                console.error("ÊòæÁ§∫ÁªìÊûúÊó∂Âá∫Èîô:", error);
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="results-section">
                        <h2 class="results-title">ÊµãËØïÁªìÊûúËÆ°ÁÆóÂá∫Èîô</h2>
                        <p>Êä±Ê≠âÔºåËÆ°ÁÆóÁªìÊûúÊó∂Âá∫Áé∞ÈîôËØØ„ÄÇËØ∑Â∞ùËØïÈáçÊñ∞ÊµãËØï„ÄÇ</p>
                        <button class="nav-button" onclick="resetTest()">ÈáçÊñ∞ÊµãËØï</button>
                    </div>
                `;
            }
        };

        // MBTIÁ±ªÂûãÊèèËø∞
        function getMBTIDescription(type) {
            const descriptions = {
                'ISTJ': 'ÂÆâÈùôËÆ§ÁúüÔºåÈÄöËøáÂÖ®Èù¢ÊÄßÂíåÂèØÈù†ÊÄßËé∑ÂæóÊàêÂäü„ÄÇÂÆûÈôÖÔºåÊ≥®Èáç‰∫ãÂÆûÔºåÊúâË¥£‰ªªÊÑü„ÄÇÁêÜÊÄßÂú∞ÂÜ≥ÂÆöÂ∫îËØ•ÂÅö‰ªÄ‰πàÔºå‰∏çÂèóÂπ≤Êâ∞Âú∞Â∑•‰Ωú„ÄÇ',
                'ISFJ': 'ÂÆâÈùôÔºåÂèãÂ•ΩÔºåÊúâË¥£‰ªªÊÑüÂíåË∞®ÊÖé„ÄÇËá¥Âäõ‰∫éÂ±•Ë°å‰πâÂä°„ÄÇÁªÜËá¥ÔºåÁ≤æÁ°ÆÔºåÂáÜÁ°Æ„ÄÇÂø†ËØöÔºå‰ΩìË¥¥ÔºåÁïôÂøÉÂπ∂ÂÖ≥ÂøÉÈáçË¶Å‰ªñ‰∫∫ÁöÑÊÑüÂèó„ÄÇ',
                'INFJ': 'ÂØªÊ±ÇÊÑè‰πâÂíåËÅîÁ≥ªÔºåÁêÜËß£‰∫∫ÈôÖÂÖ≥Á≥ª‰∏≠ÁöÑÂ§çÊùÇÊÄß„ÄÇÂØπ‰∫é‰ªñ‰∫∫ÁöÑÊÑüËßâÂíåÈúÄË¶ÅÈùûÂ∏∏ÊïèÊÑü„ÄÇÊúâË¥£‰ªªÊÑüÔºåËá¥Âäõ‰∫éËá™Â∑±ÁöÑ‰ª∑ÂÄºËßÇ„ÄÇ',
                'INTJ': 'ÂØπËá™Â∑±ÁöÑÊÉ≥Ê≥ïÂíåÂàõÈÄ†ÂäõÊúâÂæàÂº∫ÁöÑÈ©±Âä®ÂäõÔºåÊúâÂÜÖÂú®ÁöÑÊÑøÊôØÔºåÊúâËÉΩÂäõÂàÜÊûêÈóÆÈ¢òÂπ∂È´òÊïàÂú∞ÁªÑÁªáÊ¶ÇÂøµÂíåÊÉ≥Ê≥ï„ÄÇ',
                'ISTP': 'ÂÆΩÂÆπÔºåÁÅµÊ¥ªÔºåÂÆâÈùôÂú∞ËßÇÂØüÁõ¥Âà∞ÈóÆÈ¢òÂá∫Áé∞ÔºåÁÑ∂ÂêéËøÖÈÄüË°åÂä®ÊâæÂà∞ÂèØË°åÁöÑËß£ÂÜ≥ÊñπÊ°à„ÄÇÂØπ‰∫ãÂÆûÂíåÂéüÂõ†ÊÑüÂÖ¥Ë∂£ÔºåÂàÜÊûêÂéüÁêÜÂ¶Ç‰ΩïËøê‰Ωú„ÄÇ',
                'ISFP': 'ÂÆâÈùôÔºåÂèãÂ•ΩÔºåÊïèÊÑüÔºå‰ªÅÊÖà„ÄÇ‰∫´ÂèóÂΩì‰∏ãÔºåÂñúÊ¨¢Ëá™Â∑±ÁöÑÁ©∫Èó¥‰ª•ÂèäÊåâÁÖßËá™Â∑±ÁöÑÊó∂Èó¥Ë°®Â∑•‰Ωú„ÄÇÂø†ËØöÔºåÊÑøÊÑèÂ•âÁåÆÁªôÈáçË¶ÅÁöÑ‰∫∫„ÄÇ',
                'INFP': 'ÁêÜÊÉ≥‰∏ª‰πâËÄÖÔºåÂø†‰∫éËá™Â∑±ÁöÑ‰ª∑ÂÄºËßÇÂíåÈáçË¶ÅÁöÑ‰∫∫„ÄÇÂ§ñÈÉ®ÁîüÊ¥ª‰∏éÂÜÖÂú®‰ª∑ÂÄº‰∏ÄËá¥„ÄÇÂ•ΩÂ•áÔºåËøÖÈÄüÁúãÂà∞ÂèØËÉΩÊÄßÔºåÂÇ¨Âåñ‰ªñ‰∫∫ÊÉ≥Ê≥ïÁöÑÂÆûÁé∞„ÄÇ',
                'INTP': 'ÂØªÊ±ÇÂèëÁé∞ÈÄªËæëËß£ÈáäÔºåÁêÜËÆ∫ÊÄßÂÖ¥Ë∂£ËæÉÂº∫ÔºåÊäΩË±°ÊÄùËÄÉÔºå‰∏çÂñúÊ¨¢Èó≤ËÅä„ÄÇÂÆâÈùôÔºåÁÅµÊ¥ªÔºåÈÄÇÂ∫îÂäõÂº∫Ôºå‰∏ìÊ≥®ËÉΩÂäõÊÉä‰∫∫„ÄÇ',
                'ESTP': 'ÁÅµÊ¥ªÂíåÂÆπÂøçÔºåÈááÂèñÂÆûÁî®ÁöÑÊñπÊ≥ïÔºåÂÖ≥Ê≥®Âç≥Êó∂ÁªìÊûú„ÄÇÁêÜËÆ∫ÂíåÊ¶ÇÂøµËß£Èáä‰Ωø‰ªñ‰ª¨‰∏çËÄêÁÉ¶„ÄÇÂñúÊ¨¢ÁßØÊûÅÂèÇ‰∏éËß£ÂÜ≥ÈóÆÈ¢ò„ÄÇ',
                'ESFP': 'Â§ñÂêëÔºåÂèãÂ•ΩÔºåÊé•ÂèóÂäõÂº∫„ÄÇÁÉ≠Áà±ÁîüÊ¥ªÔºå‰∫∫ÂíåÁâ©Ë¥®‰∫´Âèó„ÄÇÂñúÊ¨¢‰∏é‰ªñ‰∫∫‰∏ÄËµ∑Â∑•‰ΩúÔºåÂ∞ÜÂ∏∏ËØÜÂíåÁé∞ÂÆûÊÄÅÂ∫¶Â∏¶ÂÖ•Â∑•‰Ωú‰∏≠„ÄÇ',
                'ENFP': 'ÁÉ≠ÊÉÖÔºåÊúâÊÉ≥Ë±°Âäõ„ÄÇÊääÁîüÊ¥ªËßÜ‰∏∫ÂÖÖÊª°ÂèØËÉΩÊÄß„ÄÇËÉΩÂ§üÂø´ÈÄüËÅîÁ≥ª‰∫ã‰ª∂Âíå‰ø°ÊÅØÔºåËá™‰ø°Âú∞Âü∫‰∫éÊ®°ÂºèÂÅöÂÜ≥ÂÆö„ÄÇ',
                'ENTP': 'ÊïèÊç∑ÔºåÊúâÂàõÈÄ†ÊÄßÔºåÂñÑ‰∫éÂà∫ÊøÄÊÄßËæ©ËÆ∫„ÄÇË∂≥Êô∫Â§öË∞ãËß£ÂÜ≥Êñ∞ÁöÑÂÖ∑ÊúâÊåëÊàòÊÄßÁöÑÈóÆÈ¢ò„ÄÇÂñÑ‰∫é‰∫ßÁîüÊ¶ÇÂøµÊÄßÂèØËÉΩÊÄßÔºåÁÑ∂ÂêéÂàÜÊûêÂÆÉ‰ª¨„ÄÇ',
                'ESTJ': 'ÂÆûÈôÖÔºåÁé∞ÂÆûÔºåÊ≥®Èáç‰∫ãÂÆû„ÄÇÊûúÊñ≠ÔºåËøÖÈÄüÂÆûÊñΩÂÜ≥Á≠ñ„ÄÇÁªÑÁªáÈ°πÁõÆÂíå‰∫∫ÂëòÂÆûÁé∞ÁõÆÊ†áÔºå‰∏ìÊ≥®‰∫éÂèäÊó∂Ëé∑ÂæóÁªìÊûú„ÄÇ',
                'ESFJ': 'ÁÉ≠ÂøÉÔºåÊúâËâØÂøÉÔºåÂêà‰Ωú„ÄÇÂ∏åÊúõ‰∏é‰ªñ‰∫∫ÂíåË∞êÁõ∏Â§ÑÔºåÂä™ÂäõÂ∑•‰Ωú‰ª•ÂáÜÁ°ÆÂÆåÊàêÂ∑•‰Ωú„ÄÇÂø†ËØöÔºå‰ºöÊ≥®ÊÑèÂà∞‰ªñ‰∫∫ÈúÄË¶ÅÁöÑÁªÜËäÇ„ÄÇ',
                'ENFJ': 'Ê∏©ÊöñÔºåÂêåÊÉÖÔºåÊïèÊÑüÔºåË¥üË¥£‰ªª„ÄÇÈ´òÂ∫¶ÂÖ≥Ê≥®‰ªñ‰∫∫ÁöÑÊÉÖÊÑü„ÄÅÈúÄË¶ÅÂíåÂä®Êú∫„ÄÇÂñÑ‰∫éÁúãÂà∞‰ªñ‰∫∫ÁöÑÊΩúÂäõÔºåÂ∏åÊúõÂ∏ÆÂä©‰ªñ‰ª¨ÂÆûÁé∞ÊΩúÂäõ„ÄÇ',
                'ENTJ': 'Âù¶ÁéáÔºåÊûúÊñ≠ÔºåÊúâÈ¢ÜÂØºËÉΩÂäõ„ÄÇËøÖÈÄüÁúãÂà∞‰∏çÂêàÈÄªËæëÂíå‰ΩéÊïàÁöÑÁ®ãÂ∫èÂíåÊîøÁ≠ñÔºåÂèëÂ±ïÂπ∂ÂÆûÊñΩÂÖ®Èù¢Á≥ªÁªü‰ª•Ëß£ÂÜ≥ÁªÑÁªáÈóÆÈ¢ò„ÄÇ'
            };
            
            return descriptions[type] || 'Ê≤°ÊúâÊâæÂà∞Ê≠§Á±ªÂûãÁöÑÊèèËø∞„ÄÇ';
        }

        // DISCÊèèËø∞
        function getDISCDescription(discResult) {
            // ÊâæÂá∫‰∏ªÂØºÁâπË¥®
            let dominantTrait = '';
            let maxScore = 0;
            
            for (const trait in discResult) {
                if (discResult[trait] > maxScore) {
                    maxScore = discResult[trait];
                    dominantTrait = trait;
                }
            }
            
            const descriptions = {
                'D': '‰Ω†ÂÄæÂêë‰∫éÁõ¥Êé•„ÄÅÊûúÊñ≠ÔºåÂñúÊ¨¢Êé•ÂèóÊåëÊàòÂíåËß£ÂÜ≥ÈóÆÈ¢ò„ÄÇ‰Ω†ÂèØËÉΩÊõ¥Ê≥®ÈáçÁªìÊûúËÄå‰∏çÊòØËøáÁ®ãÔºåÂÄæÂêë‰∫éÂø´ÈÄüÂÅöÂÜ≥ÂÆö„ÄÇ',
                'I': '‰Ω†ÂÄæÂêë‰∫éÂ§ñÂêë„ÄÅÁÉ≠ÊÉÖÔºåÂñúÊ¨¢‰∏é‰∫∫‰∫§ÊµÅÂíåÂª∫Á´ãÂÖ≥Á≥ª„ÄÇ‰Ω†ÂèØËÉΩÂñÑ‰∫éÊøÄÂä±‰ªñ‰∫∫ÔºåÂú®Âõ¢Èòü‰∏≠ÊúâËæÉÂº∫ÁöÑÊÑüÊüìÂäõ„ÄÇ',
                'S': '‰Ω†ÂÄæÂêë‰∫éÁ®≥ÂÆö„ÄÅËÄêÂøÉÔºåÂñúÊ¨¢Âõ¢ÈòüÂêà‰ΩúÂíåÁª¥ÊåÅÂíåË∞ê„ÄÇ‰Ω†ÂèØËÉΩË°®Áé∞Âá∫ÂæàÂº∫ÁöÑÂø†ËØöÂ∫¶ÔºåÂØπ‰ªñ‰∫∫ÁöÑÈúÄÊ±ÇÂæàÊïèÊÑü„ÄÇ',
                'C': '‰Ω†ÂÄæÂêë‰∫éÁ≤æÁ°Æ„ÄÅË∞®ÊÖéÔºåÂñúÊ¨¢ÁªÜËäÇÂíåÈ´òË¥®ÈáèÁöÑÂ∑•‰Ωú„ÄÇ‰Ω†ÂèØËÉΩ‰ºö‰ªîÁªÜÂàÜÊûêÊÉÖÂÜµÔºåÂú®ÂÅöÂÜ≥ÂÆöÂâçÊî∂ÈõÜË∂≥Â§ü‰ø°ÊÅØ„ÄÇ'
            };
            
            return descriptions[dominantTrait] || '‰Ω†ÁöÑDISCÁâπË¥®ÂàÜÂ∏ÉÁõ∏ÂØπÂπ≥Ë°°ÔºåË°®Áé∞Âá∫Â§öÊñπÈù¢ÁöÑË°å‰∏∫ÁâπÁÇπ„ÄÇ';
        }

        // Â§ß‰∫î‰∫∫Ê†ºÊèèËø∞
        function getBigFiveDescription(bigFiveResult) {
            let description = '‰Ω†ÁöÑ‰∫∫Ê†ºÁâπË¥®ÂåÖÊã¨Ôºö';
            
            if (bigFiveResult.Â§ñÂêëÊÄß >= 4) {
                description += 'ËæÉÈ´òÁöÑÂ§ñÂêëÊÄßÔºåÂñúÊ¨¢Á§æ‰∫§‰∫íÂä®ÔºåÁ≤æÂäõÂÖÖÊ≤õÔºõ';
            } else if (bigFiveResult.Â§ñÂêëÊÄß <= 2) {
                description += 'ËæÉ‰ΩéÁöÑÂ§ñÂêëÊÄßÔºåÂÅèÂ•ΩÁã¨Â§ÑÔºåÂÆâÈùôÊÄùËÄÉÔºõ';
            }
            
            if (bigFiveResult.ÂÆú‰∫∫ÊÄß >= 4) {
                description += 'ËæÉÈ´òÁöÑÂÆú‰∫∫ÊÄßÔºåÂØåÊúâÂêåÊÉÖÂøÉÔºå‰πê‰∫éÂ∏ÆÂä©‰ªñ‰∫∫Ôºõ';
            } else if (bigFiveResult.ÂÆú‰∫∫ÊÄß <= 2) {
                description += 'ËæÉ‰ΩéÁöÑÂÆú‰∫∫ÊÄßÔºåÊõ¥Áõ¥Êé•Âù¶ÁéáÔºåÁã¨Á´ãÊÄùËÄÉÔºõ';
            }
            
            if (bigFiveResult.Â∞ΩË¥£ÊÄß >= 4) {
                description += 'ËæÉÈ´òÁöÑÂ∞ΩË¥£ÊÄßÔºåÊúâÊù°ÁêÜÔºåÊ≥®ÈáçÁõÆÊ†áÔºõ';
            } else if (bigFiveResult.Â∞ΩË¥£ÊÄß <= 2) {
                description += 'ËæÉ‰ΩéÁöÑÂ∞ΩË¥£ÊÄßÔºåÊõ¥ÈöèÊÄßÁÅµÊ¥ªÔºå‰∏çÊãòÂ∞èËäÇÔºõ';
            }
            
            if (bigFiveResult.ÊÉÖÁª™Á®≥ÂÆöÊÄß >= 4) {
                description += 'ËæÉÈ´òÁöÑÊÉÖÁª™Á®≥ÂÆöÊÄßÔºåÂÜ∑ÈùôËá™‰ø°ÔºåÂéãÂäõÁÆ°ÁêÜËÉΩÂäõÂº∫Ôºõ';
            } else if (bigFiveResult.ÊÉÖÁª™Á®≥ÂÆöÊÄß <= 2) {
                description += 'ËæÉ‰ΩéÁöÑÊÉÖÁª™Á®≥ÂÆöÊÄßÔºåÊÉÖÊÑü‰∏∞ÂØåÔºåÂØπÁéØÂ¢ÉÊïèÊÑüÔºõ';
            }
            
            if (bigFiveResult.ÂºÄÊîæÊÄß >= 4) {
                description += 'ËæÉÈ´òÁöÑÂºÄÊîæÊÄßÔºåÂñúÊ¨¢Êñ∞‰ΩìÈ™åÔºåÊÄùÊÉ≥ÂºÄÊîæ„ÄÇ';
            } else if (bigFiveResult.ÂºÄÊîæÊÄß <= 2) {
                description += 'ËæÉ‰ΩéÁöÑÂºÄÊîæÊÄßÔºåÊõ¥Âä°ÂÆû‰º†ÁªüÔºåÊ≥®ÈáçÂÆûÈôÖÁªèÈ™å„ÄÇ';
            }
            
            return description;
        }

        // Ê≤üÈÄöÂª∫ËÆÆ
        function getCommunicationTips(role, mbtiType, discResult, bigFiveResult) {
            if (role === 'child') {
                return `‰Ωú‰∏∫‰∏Ä‰∏™${mbtiType}ÊÄßÊ†ºÁ±ªÂûãÁöÑÂ≠©Â≠êÔºå‰Ω†ÂèØËÉΩÊõ¥ÂñúÊ¨¢${mbtiType.includes('E') ? 'ÈÄöËøá‰∫§ÊµÅ' : 'Áã¨Á´ãÊÄùËÄÉ'}Êù•Ëß£ÂÜ≥ÈóÆÈ¢ò„ÄÇ
                ‰∏éÂÆ∂ÈïøÊ≤üÈÄöÊó∂ÔºåÂ∞ùËØïÊ∏ÖÊô∞Ë°®Ëææ‰Ω†ÁöÑÊÉ≥Ê≥ïÂíåÊÑüÂèóÔºåÁâπÂà´ÊòØÂΩì‰Ω†ÊÑüÂà∞‰∏çË¢´ÁêÜËß£Êó∂„ÄÇ
                ‰Ω†ÁöÑDISCÁâπË¥®Ë°®Êòé‰Ω†Âú®Ê≤üÈÄö‰∏≠${getDISCCommunicationStyle(discResult)}„ÄÇ
                Ê†πÊçÆ‰Ω†ÁöÑÂ§ß‰∫î‰∫∫Ê†ºÁâπË¥®ÔºåÂª∫ËÆÆ‰Ω†ÂÖ≥Ê≥®Ëá™Â∑±ÁöÑ${getBigFiveCommunicationFocus(bigFiveResult)}Ôºå
                ËøôÂ∞ÜÂ∏ÆÂä©‰Ω†‰∏éÂÆ∂ÈïøÂª∫Á´ãÊõ¥Â•ΩÁöÑÊ≤üÈÄöÂíåÁêÜËß£„ÄÇ`;
            } else {
                return `‰Ωú‰∏∫‰∏Ä‰∏™${mbtiType}ÊÄßÊ†ºÁ±ªÂûãÁöÑÂÆ∂ÈïøÔºå‰Ω†ÂèØËÉΩÂÅèÂ•Ω${mbtiType.includes('J') ? 'ÁªìÊûÑÂåñÁöÑ' : 'ÁÅµÊ¥ªÁöÑ'}ÊïôËÇ≤ÊñπÂºè„ÄÇ
                ‰∏éÂ≠©Â≠êÊ≤üÈÄöÊó∂ÔºåËÆ∞‰Ωè‰ªñ‰ª¨ÂèØËÉΩ‰∏é‰Ω†Êúâ‰∏çÂêåÁöÑÊÄùËÄÉÂíåÊÑüÂèóÊñπÂºèÔºåÂ∞ùËØïÁ´ôÂú®‰ªñ‰ª¨ÁöÑËßíÂ∫¶ÁêÜËß£ÈóÆÈ¢ò„ÄÇ
                ‰Ω†ÁöÑDISCÁâπË¥®Ë°®Êòé‰Ω†Âú®ÊïôËÇ≤‰∏≠${getDISCParentingStyle(discResult)}„ÄÇ
                Ê†πÊçÆ‰Ω†ÁöÑÂ§ß‰∫î‰∫∫Ê†ºÁâπË¥®ÔºåÂª∫ËÆÆ‰Ω†ÂÖ≥Ê≥®${getBigFiveParentingFocus(bigFiveResult)}Ôºå
                ËøôÂ∞ÜÂ∏ÆÂä©‰Ω†Êõ¥ÊúâÊïàÂú∞ÂºïÂØºÂ≠©Â≠êÁöÑÊàêÈïøÂíåÂèëÂ±ï„ÄÇ`;
            }
        }

        function getDISCCommunicationStyle(discResult) {
            // ÊâæÂá∫‰∏ªÂØºÁâπË¥®
            let dominantTrait = '';
            let maxScore = 0;
            
            for (const trait in discResult) {
                if (discResult[trait] > maxScore) {
                    maxScore = discResult[trait];
                    dominantTrait = trait;
                }
            }
            
            const styles = {
                'D': 'ÂèØËÉΩÊØîËæÉÁõ¥Êé•ÔºåÂñúÊ¨¢Âø´ÈÄüÂæóÂà∞Á≠îÊ°àÔºåÂª∫ËÆÆÂ≠¶‰π†ËÄêÂøÉÂê¨Âèñ‰ªñ‰∫∫ÊÑèËßÅ',
                'I': 'ÂñÑ‰∫éË°®ËææÔºåÂñúÊ¨¢ÂàÜ‰∫´ÊÉ≥Ê≥ïÔºåÂª∫ËÆÆÊ≥®ÊÑèÂÄæÂê¨‰ªñ‰∫∫ÁöÑÂèçÈ¶à',
                'S': 'ÂñÑËß£‰∫∫ÊÑèÔºåÊÑøÊÑèÈÖçÂêàÔºåÂª∫ËÆÆÈÄÇÂΩìË°®ËææËá™Â∑±ÁöÑÈúÄÊ±ÇÂíåÁ´ãÂú∫',
                'C': 'Ê≥®ÈáçÁªÜËäÇÂíåÁ≤æÁ°ÆÔºåÂª∫ËÆÆÂ≠¶‰ºöÊé•Âèó‰∏çÂÆåÁæéÁöÑÊÉÖÂÜµÂíåÁÅµÊ¥ªÂ∫îÂØπ'
            };
            
            return styles[dominantTrait] || 'Âú®‰∏çÂêåÊÉÖÂ¢É‰∏ãÁÅµÊ¥ªË∞ÉÊï¥Ê≤üÈÄöÊñπÂºè';
        }

        function getDISCParentingStyle(discResult) {
            // ÊâæÂá∫‰∏ªÂØºÁâπË¥®
            let dominantTrait = '';
            let maxScore = 0;
            
            for (const trait in discResult) {
                if (discResult[trait] > maxScore) {
                    maxScore = discResult[trait];
                    dominantTrait = trait;
                }
            }
            
            const styles = {
                'D': 'ÂèØËÉΩËÆæÂÆöÊòéÁ°ÆÁõÆÊ†áÂíåËßÑÂàôÔºåÂª∫ËÆÆÂ§öÂÖ≥Ê≥®Â≠©Â≠êÁöÑÊÉÖÊÑüÈúÄÊ±Ç',
                'I': 'ÂñÑ‰∫éÊøÄÂä±ÂíåÈºìÂä±Â≠©Â≠êÔºåÂª∫ËÆÆÂ¢ûÂä†ÂØπËßÑÂàôÂíå‰∏ÄËá¥ÊÄßÁöÑÈáçËßÜ',
                'S': 'ËÉΩ‰∏∫Â≠©Â≠êÊèê‰æõÁ®≥ÂÆöÂíåÊîØÊåÅÔºåÂª∫ËÆÆÈÄÇÂΩìÁªôÂ≠©Â≠êÊõ¥Â§öÊåëÊàòÂíåÊàêÈïøÁ©∫Èó¥',
                'C': 'Ê≥®ÈáçÊïôËÇ≤ÁöÑË¥®ÈáèÂíåÊ†áÂáÜÔºåÂª∫ËÆÆÊé•ÂèóÂ≠©Â≠êÁöÑ‰∏çÂÆåÁæéÂíå‰∏™ÊÄßÂ∑ÆÂºÇ'
            };
            
            return styles[dominantTrait] || 'ËÉΩÊ†πÊçÆÂ≠©Â≠êÁöÑÈúÄË¶ÅË∞ÉÊï¥ÊïôËÇ≤ÊñπÂºè';
        }

        function getBigFiveCommunicationFocus(bigFiveResult) {
            let focus = [];
            
            if (bigFiveResult.Â§ñÂêëÊÄß <= 3) {
                focus.push('‰∏ªÂä®Ë°®ËææËá™Â∑±ÁöÑÊÉ≥Ê≥ï');
            }
            
            if (bigFiveResult.ÂÆú‰∫∫ÊÄß <= 3) {
                focus.push('ÂüπÂÖªÂêåÁêÜÂøÉ');
            }
            
            if (bigFiveResult.Â∞ΩË¥£ÊÄß <= 3) {
                focus.push('ÂÖªÊàêËâØÂ•Ω‰π†ÊÉØ');
            }
            
            if (bigFiveResult.ÊÉÖÁª™Á®≥ÂÆöÊÄß <= 3) {
                focus.push('ÊÉÖÁª™ÁÆ°ÁêÜ');
            }
            
            if (bigFiveResult.ÂºÄÊîæÊÄß <= 3) {
                focus.push('ÂºÄÊîæÊÄùÁª¥');
            }
            
            if (focus.length === 0) {
                focus.push('ÁªßÁª≠‰øùÊåÅËâØÂ•ΩÁöÑÊ≤üÈÄö‰π†ÊÉØ');
            }
            
            return focus.join('Âíå');
        }

        function getBigFiveParentingFocus(bigFiveResult) {
            let focus = [];
            
            if (bigFiveResult.Â§ñÂêëÊÄß <= 3) {
                focus.push('‰∏éÂ≠©Â≠êÂàõÈÄ†Êõ¥Â§ö‰∫íÂä®Êú∫‰ºö');
            }
            
            if (bigFiveResult.ÂÆú‰∫∫ÊÄß <= 3) {
                focus.push('ÁêÜËß£Â≠©Â≠êÁöÑÊÉÖÊÑüÈúÄÊ±Ç');
            }
            
            if (bigFiveResult.Â∞ΩË¥£ÊÄß >= 4) {
                focus.push('ÂÖÅËÆ∏Â≠©Â≠êÊúâÊé¢Á¥¢ÂíåÁäØÈîôÁöÑÁ©∫Èó¥');
            }
            
            if (bigFiveResult.ÊÉÖÁª™Á®≥ÂÆöÊÄß <= 3) {
                focus.push('‰øùÊåÅÊÉÖÁª™Á®≥ÂÆö');
            }
            
            if (bigFiveResult.ÂºÄÊîæÊÄß <= 3) {
                focus.push('Êé•ÂèóÂ≠©Â≠êÁöÑÊñ∞ÊÉ≥Ê≥ï');
            }
            
            if (focus.length === 0) {
                focus.push('ÁªßÁª≠‰øùÊåÅÂΩìÂâçÁöÑÊïôËÇ≤ÊñπÂºè');
            }
            
            return focus.join('Âíå');
        }

        // ÈáçÁΩÆÊµãËØïÔºåÊ∏ÖÈô§‰øùÂ≠òÁöÑËßíËâ≤
        window.resetTest = function() {
            // Ê∏ÖÈô§localStorage‰∏≠‰øùÂ≠òÁöÑËßíËâ≤
            localStorage.removeItem('selectedRole');
            
            // ÈáçÁΩÆUIÁä∂ÊÄÅ
            document.getElementById('roleSelection').style.display = 'flex';
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
            
            // ÈáçÁΩÆÂÖ∂‰ªñÁä∂ÊÄÅ
            window.currentRole = null;
            window.currentSection = null;
            window.currentQuestionIndex = 0;
            window.answers = {
                mbti: [],
                disc: [],
                bigFive: []
            };
        };
    </script>
</body>
</html> 
    <script>
        // ... existing code ...

        // ÂÖ®Â±ÄÂèòÈáèÔºåÁî®‰∫éÂ≠òÂÇ®ÊµãËØïÁªìÊûú
        let testResults = {}; 

        // ... existing code ...

        // ËÆ°ÁÆóÊµãËØïÁªìÊûú
        window.calculateResults = function() {
            console.log("ÂºÄÂßãËÆ°ÁÆóÊµãËØïÁªìÊûú...");
            console.log("Áî®Êà∑Á≠îÊ°à:", window.answers);

            // --- MBTI ËÆ°ÁÆó ---
            let mbtiScores = { E: 0, I: 0, S: 0, N: 0, T: 0, F: 0, J: 0, P: 0 };
            const mbtiQuestions = window.questionBank[window.currentRole].mbti;
            for (let i = 0; i < mbtiQuestions.length; i++) {
                const answerIndex = window.answers.mbti[i];
                if (answerIndex !== undefined && mbtiQuestions[i].options[answerIndex]) {
                    const dimension = mbtiQuestions[i].options[answerIndex].dimension;
                    if (dimension && mbtiScores.hasOwnProperty(dimension)) {
                        mbtiScores[dimension]++;
                    }
                }
            }
            let mbtiType = "";
            mbtiType += (mbtiScores.E >= mbtiScores.I) ? 'E' : 'I';
            mbtiType += (mbtiScores.S >= mbtiScores.N) ? 'S' : 'N';
            mbtiType += (mbtiScores.T >= mbtiScores.F) ? 'T' : 'F';
            mbtiType += (mbtiScores.J >= mbtiScores.P) ? 'J' : 'P';
            console.log("MBTI ÂàÜÊï∞:", mbtiScores);
            console.log("MBTI Á±ªÂûã:", mbtiType);


            // --- DISC ËÆ°ÁÆó ---
            let discScores = { D: 0, I: 0, S: 0, C: 0 };
            const discQuestions = window.questionBank[window.currentRole].disc;
            for (let i = 0; i < discQuestions.length; i++) {
                const answerIndex = window.answers.disc[i];
                 if (answerIndex !== undefined && discQuestions[i].options[answerIndex]) {
                    const dimension = discQuestions[i].options[answerIndex].dimension;
                     if (dimension && discScores.hasOwnProperty(dimension)) {
                        discScores[dimension]++;
                    }
                }
            }
             // ÁÆÄÂçïÁöÑ DISC ‰∏ªÂØºÁ±ªÂûãÁ°ÆÂÆöÔºàÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÂÆûÁé∞Êõ¥Â§çÊùÇÁöÑÈÄªËæëÔºâ
            let dominantDisc = Object.keys(discScores).reduce((a, b) => discScores[a] > discScores[b] ? a : b);
            console.log("DISC ÂàÜÊï∞:", discScores);
            console.log("DISC ‰∏ªÂØºÁ±ªÂûã:", dominantDisc);


            // --- Â§ß‰∫î‰∫∫Ê†ºËÆ°ÁÆó ---
            let bigFiveScores = { O: 0, C: 0, E: 0, A: 0, N: 0 };
            const bigFiveQuestions = window.questionBank[window.currentRole].bigFive;
            for (let i = 0; i < bigFiveQuestions.length; i++) {
                const answerValue = window.answers.bigFive[i]; // ÂàÜÊï∞ 1-5
                if (answerValue !== undefined) {
                    const dimension = bigFiveQuestions[i].dimension;
                    const reversed = bigFiveQuestions[i].reversed || false;
                    let score = answerValue;
                    // Â§ÑÁêÜÂèçÂêëËÆ°ÂàÜÈ¢ò
                    if (reversed) {
                        score = 6 - answerValue;
                    }
                    if (dimension && bigFiveScores.hasOwnProperty(dimension)) {
                        bigFiveScores[dimension] += score;
                    }
                }
            }
             // ÂèØ‰ª•Â∞ÜÂéüÂßãÂàÜÊï∞ËΩ¨Êç¢‰∏∫ÁôæÂàÜÊØîÊàñÂÖ∂‰ªñÊ†áÂáÜÂåñÂàÜÊï∞
            console.log("Â§ß‰∫î‰∫∫Ê†ºÂéüÂßãÂàÜÊï∞:", bigFiveScores);


            // Â∞ÜËÆ°ÁÆóÁªìÊûúÂ≠òÂÇ®Âú®ÂÖ®Â±ÄÂèòÈáè‰∏≠
            testResults = {
                mbti: { type: mbtiType, scores: mbtiScores },
                disc: { dominant: dominantDisc, scores: discScores },
                bigFive: { scores: bigFiveScores }
            };

            console.log("ËÆ°ÁÆóÂÆåÊàêÁöÑÊµãËØïÁªìÊûú:", testResults);
            return testResults; // ËøîÂõûËÆ°ÁÆóÁªìÊûú
        };


        // ÊòæÁ§∫ÊµãËØïÁªìÊûú
        window.showResults = function() {
            console.log("ÂºÄÂßãÊòæÁ§∫ÊµãËØïÁªìÊûú...");
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';

            // È¶ñÂÖàËÆ°ÁÆóÁªìÊûú
            const results = calculateResults(); // Ë∞ÉÁî®ËÆ°ÁÆóÂáΩÊï∞Ëé∑ÂèñÂä®ÊÄÅÁªìÊûú

            if (!results) {
                console.error("Êó†Ê≥ïËé∑ÂèñËÆ°ÁÆóÁªìÊûúÔºÅ");
                alert("ËÆ°ÁÆóÁªìÊûúÊó∂Âá∫ÈîôÔºåËØ∑ÈáçËØï„ÄÇ");
                return;
            }
             console.log("Áî®‰∫éÊòæÁ§∫ÁöÑÁªìÊûú:", results);


            // --- ÊòæÁ§∫ MBTI ÁªìÊûú ---
            const mbtiResultContainer = document.getElementById('mbtiResult');
            mbtiResultContainer.innerHTML = ''; // Ê∏ÖÁ©∫ÊóßÂÜÖÂÆπ
            if (results.mbti && results.mbti.type) {
                 const mbtiData = window.personalityDescriptions.mbti[results.mbti.type];
                 if (mbtiData) {
                    mbtiResultContainer.innerHTML = `
                        <div class="role-title-result">
                            <span class="role-icon">${window.currentRole === 'child' ? 'üë∂' : 'üë®‚Äçüë©'}</span>
                            ÊÇ®ÁöÑ MBTI Á±ªÂûã: <span class="mbti-type">${results.mbti.type} (${mbtiData.name})</span>
                        </div>
                        <p class="mbti-description">${mbtiData.description}</p>
                        <div class="mbti-details">
                            <p class="mbti-trait"><strong>‰ºòÂäø:</strong> ${mbtiData.strengths.join(', ')}</p>
                            <p class="mbti-trait"><strong>ÂèëÂ±ïÂª∫ËÆÆ:</strong> ${mbtiData.weaknesses.join(', ')}</p>
                        </div>
                    `;
                } else {
                     mbtiResultContainer.textContent = `ËÆ°ÁÆóÂá∫ÁöÑ MBTI Á±ªÂûã: ${results.mbti.type} (ÊèèËø∞‰ø°ÊÅØÊú™ÊâæÂà∞)`;
                }
            } else {
                mbtiResultContainer.textContent = 'Êú™ËÉΩËÆ°ÁÆóÂá∫ MBTI Á±ªÂûã„ÄÇ';
            }


            // --- ÊòæÁ§∫ DISC ÁªìÊûú (Á§∫‰æãÔºöÁÆÄÂçïÊñáÊú¨ÔºåÂèØ‰ª•ÊõøÊç¢‰∏∫ÂõæË°®) ---
            const discSection = document.getElementById('discSection');
             const discChartContainer = document.getElementById('discChart');
             discChartContainer.innerHTML = ''; // Ê∏ÖÁ©∫ÊóßÂÜÖÂÆπ
             if (results.disc && results.disc.scores) {
                 // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÁªòÂà∂ DISC ÂõæË°®ÁöÑ‰ª£Á†Å (‰æãÂ¶Ç‰ΩøÁî® Chart.js)
                 // ÊöÇÊó∂Áî®ÊñáÊú¨ÊòæÁ§∫ÂàÜÊï∞
                 let discText = '<h3>DISC ÂàÜÊï∞:</h3><ul>';
                 for (const [key, value] of Object.entries(results.disc.scores)) {
                     discText += `<li>${key}: ${value}</li>`;
                 }
                 discText += '</ul>';
                 discChartContainer.innerHTML = discText;

                 // Ê∑ªÂä† DISC ÊèèËø∞
                 const discDesc = window.personalityDescriptions.disc[results.disc.dominant];
                 if(discDesc) {
                     const descElement = document.createElement('div');
                     descElement.className = 'disc-description';
                     descElement.innerHTML = `
                         <p><strong>ÊÇ®ÁöÑ‰∏ªÂØºË°å‰∏∫È£éÊ†º: ${results.disc.dominant} (${discDesc.name})</strong></p>
                         <p>${discDesc.description}</p>
                     `;
                     // Â∞ÜÊèèËø∞Ê∑ªÂä†Âà∞ DISC SectionÔºåËÄå‰∏çÊòØ Chart ÂÆπÂô®
                     // Á°Æ‰øùÂè™Ê∑ªÂä†‰∏ÄÊ¨°
                     const existingDesc = discSection.querySelector('.disc-description');
                     if (existingDesc) {
                         existingDesc.remove();
                     }
                     discSection.appendChild(descElement);
                 }

             } else {
                 discChartContainer.textContent = 'Êú™ËÉΩËÆ°ÁÆóÂá∫ DISC ÂàÜÊï∞„ÄÇ';
             }


            // --- ÊòæÁ§∫Â§ß‰∫î‰∫∫Ê†ºÁªìÊûú (Á§∫‰æãÔºöËøõÂ∫¶Êù°) ---
            const bigFiveSection = document.getElementById('bigFiveSection');
            const bigFiveChartContainer = document.getElementById('bigFiveChart');
            bigFiveChartContainer.innerHTML = ''; // Ê∏ÖÁ©∫ÊóßÂÜÖÂÆπ
            if (results.bigFive && results.bigFive.scores) {
                const bigFiveMapping = { O: 'ÂºÄÊîæÊÄß (Openness)', C: 'Â∞ΩË¥£ÊÄß (Conscientiousness)', E: 'Â§ñÂêëÊÄß (Extraversion)', A: 'ÂÆú‰∫∫ÊÄß (Agreeableness)', N: 'Á•ûÁªèË¥®ÊÄß (Neuroticism)' };
                // ÂÅáËÆæÊØè‰∏™Áª¥Â∫¶ÁöÑÊúÄÈ´òÂèØËÉΩÂéüÂßãÂàÜÊòØ 5 * (È¢òÁõÆÊï∞ / 5)
                // ÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÈ¢òÁõÆÊï∞ÈáèË∞ÉÊï¥ÊúÄÂ§ßÂÄº
                const maxScorePerDimension = 5 * (window.questionBank[window.currentRole].bigFive.length / 5); // Á≤óÁï•‰º∞ËÆ°

                for (const [key, value] of Object.entries(results.bigFive.scores)) {
                    const percentage = Math.max(0, Math.min(100, Math.round((value / maxScorePerDimension) * 100))); // ËΩ¨Êç¢‰∏∫ÁôæÂàÜÊØî
                    const traitBar = document.createElement('div');
                    traitBar.className = 'trait-bar';
                    traitBar.innerHTML = `
                        <div class="trait-label">${bigFiveMapping[key] || key}</div>
                        <div class="trait-progress">
                            <div class="trait-fill" style="width: ${percentage}%;"></div>
                        </div>
                        <div class="trait-value">${percentage}%</div>
                    `;
                    bigFiveChartContainer.appendChild(traitBar);
                }

                 // Ê∑ªÂä†Â§ß‰∫î‰∫∫Ê†ºÊï¥‰ΩìÊèèËø∞ÔºàÂ¶ÇÊûúÈúÄË¶ÅÔºâ
                 const big5DescElement = document.createElement('div');
                 big5DescElement.className = 'big5-description';
                 // ÂèØ‰ª•Ê†πÊçÆÂàÜÊï∞È´ò‰ΩéÁªÑÂêàÁîüÊàêÊèèËø∞
                 big5DescElement.innerHTML = `<p>‰ª•‰∏äÊòØÂ§ß‰∫î‰∫∫Ê†ºÂêÑÁª¥Â∫¶ÁöÑÂæóÂàÜÊÉÖÂÜµ„ÄÇ</p>`;
                 // Á°Æ‰øùÂè™Ê∑ªÂä†‰∏ÄÊ¨°
                 const existingDesc = bigFiveSection.querySelector('.big5-description');
                 if (existingDesc) {
                     existingDesc.remove();
                 }
                 bigFiveSection.appendChild(big5DescElement);

            } else {
                bigFiveChartContainer.textContent = 'Êú™ËÉΩËÆ°ÁÆóÂá∫Â§ß‰∫î‰∫∫Ê†ºÂàÜÊï∞„ÄÇ';
            }

            // --- ÊòæÁ§∫Ê≤üÈÄöÂª∫ËÆÆ ---
            const tipsContainer = document.getElementById('communicationTips');
            tipsContainer.innerHTML = ''; // Ê∏ÖÁ©∫ÊóßÂÜÖÂÆπ
            // Âü∫‰∫éËÆ°ÁÆóÂá∫ÁöÑÁªìÊûúÁîüÊàêÊ≤üÈÄöÂª∫ËÆÆ
            // ËøôÊòØ‰∏Ä‰∏™Â§çÊùÇÈÄªËæëÔºåÈúÄË¶ÅÁªìÂêàÂÆ∂ÈïøÂíåÂ≠©Â≠êÁöÑÊµãËØïÁªìÊûú
            // ÊöÇÊó∂ÁïôÁ©∫ÊàñÊòæÁ§∫ÈÄöÁî®ÊèêÁ§∫
            tipsContainer.innerHTML = `
                <h3>Ê≤üÈÄöÂª∫ËÆÆ</h3>
                <p>ÔºàËøôÈáåÂ∞ÜÊ†πÊçÆÊÇ®ÂíåÂ≠©Â≠êÁöÑÊÄßÊ†ºÊµãËØïÁªìÊûúÁîüÊàê‰∏™ÊÄßÂåñÁöÑÊ≤üÈÄöÂª∫ËÆÆÔºâ</p>
                <p>ËØ∑ÁÇπÂáª‚ÄúÂºÄÂßãÂØπËØù‚ÄùÂ∞ÜÊµãËØïÁªìÊûúÂèëÈÄÅÁªô AIÔºåËé∑ÂèñÊõ¥ËØ¶ÁªÜÁöÑÂàÜÊûêÂíåÂª∫ËÆÆ„ÄÇ</p>
            `;


            console.log("ÁªìÊûúÊòæÁ§∫ÂÆåÊàê„ÄÇ");
        };

        // ÂºÄÂßãÂØπËØùÊåâÈíÆÁöÑÈÄªËæë
        window.startChatWithAlert = function() {
            console.log("ÁÇπÂáª‰∫ÜÂºÄÂßãÂØπËØùÊåâÈíÆ");
            // Á°Æ‰øùÁªìÊûúÂ∑≤ÁªèËÆ°ÁÆóÂπ∂Â≠òÂÇ®Âú® testResults ‰∏≠
            if (!testResults || Object.keys(testResults).length === 0) {
                 console.warn("ÊµãËØïÁªìÊûúÂ∞öÊú™ËÆ°ÁÆóÊàñ‰∏∫Á©∫ÔºåÂ∞ùËØïÈáçÊñ∞ËÆ°ÁÆó...");
                 calculateResults(); // Â∞ùËØïÂÜçÊ¨°ËÆ°ÁÆó
                 if (!testResults || Object.keys(testResults).length === 0) {
                     alert("Êó†Ê≥ïËé∑ÂèñÊµãËØïÁªìÊûúÔºåËØ∑ÂÖàÂÆåÊàêÊµãËØï„ÄÇ");
                     console.error("Êó†Ê≥ïËé∑ÂèñÊàñËÆ°ÁÆóÊµãËØïÁªìÊûú„ÄÇ");
                     return;
                 }
            }

            try {
                // Â∞ÜÊúÄÁªàÁªìÊûú‰øùÂ≠òÂà∞ localStorage
                localStorage.setItem('personalityResults', JSON.stringify(testResults));
                localStorage.setItem('selectedRole', window.currentRole); // Á°Æ‰øùÂ≠òÂÇ®‰∫ÜËßíËâ≤
                console.log("ÊµãËØïÁªìÊûúÂ∑≤‰øùÂ≠òÂà∞ localStorage:", testResults);

                // ÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
                alert("Â∑≤ÁªèÊääÊµãËØïÁªìÊûúÊèê‰∫§ÁªôAI‰ª•‰æø‰∫éÊõ¥Â•ΩÁöÑÈíàÂØπÊÄßÁöÑÊèêÂª∫ËÆÆ");

                // Ë∑≥ËΩ¨Âà∞ËÅäÂ§©È°µÈù¢
                window.location.href = 'chat.html';
            } catch (error) {
                console.error("‰øùÂ≠òÁªìÊûúÊàñË∑≥ËΩ¨Êó∂Âá∫Èîô:", error);
                alert("Â§ÑÁêÜÁªìÊûúÊó∂ÂèëÁîüÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ");
            }
        };

        // ‰øÆÊîπ‚ÄúÂºÄÂßãÂØπËØù‚ÄùÊåâÈíÆÁöÑ onclick ‰∫ã‰ª∂
        // Âú® HTML ‰∏≠ÊâæÂà∞Ëøô‰∏™ÊåâÈíÆÂπ∂Á°Æ‰øùÂÆÉË∞ÉÁî®ÁöÑÊòØ startChatWithAlert()
        // <button class="nav-button" onclick="startChatWithAlert()">ÂºÄÂßãÂØπËØù</button>


        // ... a lot of existing code ...

        // ÈáçÁΩÆÊµãËØï
        window.resetTest = function() {
            console.log("ÈáçÁΩÆÊµãËØï...");
            // Ê∏ÖÈô§Á≠îÊ°àÂíåÁä∂ÊÄÅ
            window.currentSection = 'mbti';
            window.currentQuestionIndex = 0;
            window.answers = { mbti: [], disc: [], bigFive: [] };
            testResults = {}; // Ê∏ÖÁ©∫ÂÖ®Â±ÄÁªìÊûúÂèòÈáè
            localStorage.removeItem('personalityResults'); // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®ÁöÑÁªìÊûú
            localStorage.removeItem('selectedRole'); // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®ÁöÑËßíËâ≤

            // ÈöêËóèÁªìÊûúÔºåÊòæÁ§∫ËßíËâ≤ÈÄâÊã©
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('roleSelection').style.display = 'flex'; // ÊòæÁ§∫ËßíËâ≤ÈÄâÊã©

            // ÈáçÁΩÆËøõÂ∫¶Êù°
            document.getElementById('progressBar').style.width = '0%';
            console.log("ÊµãËØïÂ∑≤ÈáçÁΩÆ„ÄÇ");
        };

        // ... existing code ...

    </script>
</body>
</html>