<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº²å­æ€§æ ¼åŒ¹é…åˆ†æ - å’Œäº‹å®</title>
    <script src="./personality_questions.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --background-color: #f5f7fa;
            --text-color: #2c3e50;
            --border-radius: 15px;
            --shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: SimSun, 'å®‹ä½“', serif;
            background: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .test-header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.8s ease;
        }

        .test-header h1 {
            font-size: 2rem;
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .test-header p {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 2rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
            width: 0%;
        }

        .question-container {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option-button {
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1rem;
            color: var(--text-color);
        }

        .option-button:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .option-button.selected {
            border-color: var(--primary-color);
            background: rgba(52, 152, 219, 0.1);
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding: 0 1rem;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .likert-radio {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .likert-radio:checked {
            border-color: var(--primary-color);
            background: var(--primary-color);
        }

        .likert-label {
            font-size: 0.9rem;
            color: #666;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .nav-button {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            background: var(--primary-color);
            color: white;
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-button:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .back-button {
            background: #95a5a6;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .role-selection {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 3rem 0;
            animation: fadeInUp 0.8s ease;
        }

        .role-card {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 200px;
        }

        .role-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .role-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .role-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .role-description {
            font-size: 0.9rem;
            color: #666;
        }

        .role-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: none;
            align-items: center;
            gap: 0.5rem;
            animation: fadeInRight 0.5s ease;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-indicator:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .role-indicator .role-icon {
            font-size: 2rem;
            margin: 0;
        }

        .role-indicator .role-text {
            font-size: 1rem;
            color: var(--text-color);
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .results-container {
            display: none;
            animation: fadeInUp 0.8s ease;
        }

        .results-section {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .results-chart {
            margin: 2rem 0;
            height: 300px;
        }

        .trait-bar {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .trait-label {
            width: 120px;
            font-size: 0.9rem;
        }

        .trait-progress {
            flex-grow: 1;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .trait-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 1s ease;
        }

        .trait-value {
            width: 50px;
            text-align: right;
            font-size: 0.9rem;
            margin-left: 1rem;
        }

        .role-title-result {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .role-icon {
            font-size: 2rem;
            margin-right: 0.5rem;
        }

        .mbti-type {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .mbti-description {
            font-size: 1rem;
            color: #666;
        }

        .mbti-details {
            margin-top: 0.5rem;
        }

        .mbti-trait {
            margin-bottom: 0.25rem;
        }

        .disc-description {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .big5-description {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .communicationTips {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="role-indicator" id="roleIndicator" onclick="startPersonalityTest()">
        <div class="role-icon" id="roleIcon"></div>
        <div class="role-text" id="roleText"></div>
    </div>

    <div class="container">
        <div class="test-header">
            <h1>äº²å­æ€§æ ¼åŒ¹é…åˆ†æ</h1>
            <p>é€šè¿‡ç§‘å­¦çš„æ€§æ ¼æµ‹è¯„ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£å½¼æ­¤ï¼Œæå‡æ²Ÿé€šæ•ˆæœ</p>
        </div>

        <div id="roleSelection" class="role-selection">
            <div class="role-card" onclick="startTest('child')">
                <div class="role-icon">ğŸ‘¶</div>
                <div class="role-title">æˆ‘æ˜¯å­©å­</div>
                <div class="role-description">é€‚åˆ6-15å²çš„é’å°‘å¹´ï¼Œå¸®åŠ©äº†è§£è‡ªå·±çš„æ€§æ ¼ç‰¹ç‚¹</div>
            </div>
            <div class="role-card" onclick="startTest('parent')">
                <div class="role-icon">ğŸ‘¨â€ğŸ‘©</div>
                <div class="role-title">æˆ‘æ˜¯å®¶é•¿</div>
                <div class="role-description">é€‚åˆå®¶é•¿ï¼Œäº†è§£è‡ªå·±çš„æ•™è‚²é£æ ¼ä¸æ²Ÿé€šæ–¹å¼</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="question-container" id="questionContainer" style="display: none;">
            <div class="question-text" id="questionText"></div>
            <div class="options-container" id="optionsContainer"></div>
            <div class="navigation-buttons">
                <button class="nav-button back-button" id="prevButton" onclick="previousQuestion()">ä¸Šä¸€é¢˜</button>
                <button class="nav-button" id="nextButton" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <div class="results-container" id="resultsContainer" style="display: none;">
            <div class="results-section">
                <h2 class="results-title">MBTI æ€§æ ¼ç±»å‹</h2>
                <div id="mbtiResult"></div>
            </div>
            <div class="results-section" id="discSection">
                <h2 class="results-title">DISC è¡Œä¸ºé£æ ¼</h2>
                <div class="results-chart" id="discChart"></div>
            </div>
            <div class="results-section" id="bigFiveSection">
                <h2 class="results-title">å¤§äº”äººæ ¼ç‰¹è´¨</h2>
                <div class="results-chart" id="bigFiveChart"></div>
            </div>
            <div class="results-section">
                <div id="communicationTips"></div>
            </div>
            <div class="navigation-buttons">
                <button class="nav-button back-button" onclick="window.location.reload()">é‡æ–°æµ‹è¯•</button>
                <button class="nav-button" onclick="window.location.href='chat.html'">å¼€å§‹å¯¹è¯</button>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–å…¨å±€çŠ¶æ€
        window.currentRole = localStorage.getItem('selectedRole') || 'child';
        window.currentSection = 'mbti';
        window.currentQuestionIndex = 0;
        window.answers = {
            mbti: [],
            disc: [],
            bigFive: []
        };

        // é¡µé¢åŠ è½½å®Œæˆåç›´æ¥å¼€å§‹æµ‹è¯•
        window.addEventListener('DOMContentLoaded', function() {
            // éšè—è§’è‰²é€‰æ‹©ï¼Œæ˜¾ç¤ºé—®é¢˜å®¹å™¨
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'block';
            
            // æ˜¾ç¤ºè§’è‰²æŒ‡ç¤ºå™¨
            showRoleIndicator(window.currentRole);
            
            // å¼€å§‹æµ‹è¯•
            startPersonalityTest();
        });

        function showRoleIndicator(role) {
            const roleIndicator = document.getElementById('roleIndicator');
            const roleIcon = document.getElementById('roleIcon');
            const roleText = document.getElementById('roleText');
            
            if (role === 'child') {
                roleIcon.textContent = 'ğŸ‘¶';
                roleText.textContent = 'å­©å­è§†è§’';
            } else {
                roleIcon.textContent = 'ğŸ‘¨â€ğŸ‘©';
                roleText.textContent = 'å®¶é•¿è§†è§’';
            }
            
            roleIndicator.style.display = 'flex';
        }

        window.startTest = function(role) {
            window.currentRole = role;
            // ä¿å­˜è§’è‰²é€‰æ‹©
            localStorage.setItem('selectedRole', role);
            showRoleIndicator(role);
            
            // éšè—è§’è‰²é€‰æ‹©ï¼Œæ˜¾ç¤ºé—®é¢˜
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('questionContainer').style.display = 'block';
            
            // å¼€å§‹æµ‹è¯•
            startPersonalityTest();
        };

        window.startPersonalityTest = function() {
            // é‡ç½®æµ‹è¯•çŠ¶æ€
            window.currentSection = 'mbti';
            window.currentQuestionIndex = 0;
            window.answers = {
                mbti: [],
                disc: [],
                bigFive: []
            };
            
            showQuestion();
        };

        window.showQuestion = function() {
            const question = getCurrentQuestion();
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            if (question.type === 'likert5') {
                const likertScale = document.createElement('div');
                likertScale.className = 'likert-scale';
                
                for (let i = 1; i <= 5; i++) {
                    const option = document.createElement('div');
                    option.className = 'likert-option';
                    
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = 'likert';
                    radio.value = i;
                    radio.className = 'likert-radio';
                    radio.onclick = () => selectOption(i);
                    
                    const label = document.createElement('label');
                    label.className = 'likert-label';
                    label.textContent = getLikertLabel(i);
                    
                    option.appendChild(radio);
                    option.appendChild(label);
                    likertScale.appendChild(option);
                }
                
                optionsContainer.appendChild(likertScale);
            } else {
                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option-button';
                    button.textContent = option.text;
                    button.onclick = () => selectOption(option.value);
                    optionsContainer.appendChild(button);
                });
            }

            updateNavigationButtons();
            updateProgressBar();
        };

        window.getCurrentQuestion = function() {
            return window.questionBank[window.currentRole][window.currentSection][window.currentQuestionIndex];
        };

        window.selectOption = function(value) {
            const question = getCurrentQuestion();
            const answer = {
                questionId: question.id,
                value: value,
                dimension: question.dimension
            };

            if (question.type === 'likert5') {
                answer.score = value;
            }

            // æ›´æ–°ç­”æ¡ˆ
            const existingAnswerIndex = window.answers[window.currentSection].findIndex(
                a => a.questionId === question.id
            );

            if (existingAnswerIndex !== -1) {
                window.answers[window.currentSection][existingAnswerIndex] = answer;
            } else {
                window.answers[window.currentSection].push(answer);
            }

            // æ›´æ–°UI
            const options = document.querySelectorAll('.option-button');
            options.forEach(option => option.classList.remove('selected'));
            if (event && event.target && question.type !== 'likert5') {
                event.target.classList.add('selected');
            }

            // å¯ç”¨ä¸‹ä¸€é¢˜æŒ‰é’®
            document.getElementById('nextButton').disabled = false;
        };

        window.getLikertLabel = function(value) {
            switch(value) {
                case 1: return 'å®Œå…¨ä¸åŒæ„';
                case 2: return 'ä¸å¤ªåŒæ„';
                case 3: return 'ä¸€èˆ¬';
                case 4: return 'æ¯”è¾ƒåŒæ„';
                case 5: return 'å®Œå…¨åŒæ„';
            }
        };

        window.previousQuestion = function() {
            if (window.currentQuestionIndex > 0) {
                window.currentQuestionIndex--;
            } else if (window.currentSection === 'disc') {
                window.currentSection = 'mbti';
                window.currentQuestionIndex = window.questionBank[window.currentRole].mbti.length - 1;
            } else if (window.currentSection === 'bigFive') {
                window.currentSection = 'disc';
                window.currentQuestionIndex = window.questionBank[window.currentRole].disc.length - 1;
            }
            showQuestion();
        };

        window.nextQuestion = function() {
            const currentSectionQuestions = window.questionBank[window.currentRole][window.currentSection];
            
            if (window.currentQuestionIndex < currentSectionQuestions.length - 1) {
                window.currentQuestionIndex++;
                showQuestion();
            } else if (window.currentSection === 'mbti') {
                window.currentSection = 'disc';
                window.currentQuestionIndex = 0;
                showQuestion();
            } else if (window.currentSection === 'disc') {
                window.currentSection = 'bigFive';
                window.currentQuestionIndex = 0;
                showQuestion();
            } else {
                showResults();
            }
        };

        window.updateNavigationButtons = function() {
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            
            prevButton.disabled = window.currentQuestionIndex === 0 && window.currentSection === 'mbti';
            nextButton.disabled = !window.answers[window.currentSection].some(
                a => a.questionId === getCurrentQuestion().id
            );
        };

        window.updateProgressBar = function() {
            const totalQuestions = 
                window.questionBank[window.currentRole].mbti.length + 
                window.questionBank[window.currentRole].disc.length + 
                window.questionBank[window.currentRole].bigFive.length;
            
            const completedQuestions = 
                (window.currentSection === 'disc' ? window.questionBank[window.currentRole].mbti.length : 0) +
                (window.currentSection === 'bigFive' ? window.questionBank[window.currentRole].mbti.length + window.questionBank[window.currentRole].disc.length : 0) +
                window.currentQuestionIndex;
            
            const progress = (completedQuestions / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        };

        window.showResults = function() {
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';

            // è·å–è§’è‰²
            const role = window.currentRole;
            const roleTitleElem = document.createElement('div');
            roleTitleElem.className = 'role-title-result';
            roleTitleElem.innerHTML = role === 'child' 
                ? '<span class="role-icon">ğŸ‘¶</span> å­©å­æ€§æ ¼åˆ†ææŠ¥å‘Š' 
                : '<span class="role-icon">ğŸ‘¨â€ğŸ‘©</span> å®¶é•¿è‚²å„¿é£æ ¼åˆ†ææŠ¥å‘Š';
            
            // æ·»åŠ è§’è‰²æ ‡é¢˜
            const resultContainer = document.getElementById('resultsContainer');
            resultContainer.insertBefore(roleTitleElem, resultContainer.firstChild);

            // åˆ†æ MBTI ç»“æœ
            const mbtiResult = window.analyzeMBTI(window.answers.mbti);
            const mbtiTypeDesc = getMBTIDescription(mbtiResult.E_I + mbtiResult.S_N + mbtiResult.T_F + mbtiResult.J_P, role);
            document.getElementById('mbtiResult').innerHTML = `
                <div class="mbti-type">${mbtiResult.E_I}${mbtiResult.S_N}${mbtiResult.T_F}${mbtiResult.J_P}</div>
                <div class="mbti-description">${mbtiTypeDesc}</div>
                <div class="mbti-details">
                    <div class="mbti-trait">${mbtiResult.E_I === 'E' ? 'å¤–å‘' : 'å†…å‘'} (${mbtiResult.E_I})</div>
                    <div class="mbti-trait">${mbtiResult.S_N === 'S' ? 'å®æ„Ÿ' : 'ç›´è§‰'} (${mbtiResult.S_N})</div>
                    <div class="mbti-trait">${mbtiResult.T_F === 'T' ? 'ç†æ€§' : 'æ„Ÿæ€§'} (${mbtiResult.T_F})</div>
                    <div class="mbti-trait">${mbtiResult.J_P === 'J' ? 'è®¡åˆ’' : 'éšæ€§'} (${mbtiResult.J_P})</div>
                </div>
            `;

            // åˆ†æ DISC ç»“æœ
            const discResult = window.analyzeDISC(window.answers.disc);
            const discChart = document.getElementById('discChart');
            renderTraitBars(discChart, discResult);
            
            // æ·»åŠ DISCæè¿°
            const discDescElem = document.createElement('div');
            discDescElem.className = 'disc-description';
            discDescElem.innerHTML = getDISCDescription(discResult, role);
            document.getElementById('discSection').appendChild(discDescElem);

            // åˆ†æå¤§äº”äººæ ¼ç»“æœ
            const bigFiveResult = window.analyzeBigFive(window.answers.bigFive);
            const bigFiveChart = document.getElementById('bigFiveChart');
            renderTraitBars(bigFiveChart, bigFiveResult);
            
            // æ·»åŠ å¤§äº”äººæ ¼æè¿°
            const big5DescElem = document.createElement('div');
            big5DescElem.className = 'big5-description';
            big5DescElem.innerHTML = getBig5Description(bigFiveResult, role);
            document.getElementById('bigFiveSection').appendChild(big5DescElem);

            // ç”Ÿæˆæ²Ÿé€šå»ºè®®
            generateCommunicationTips(role, mbtiResult, discResult, bigFiveResult);

            // ä¿å­˜ç»“æœåˆ° localStorage
            localStorage.setItem('personalityTestResults', JSON.stringify({
                role: window.currentRole,
                mbti: mbtiResult,
                disc: discResult,
                bigFive: bigFiveResult,
                timestamp: new Date().toISOString()
            }));
        };

        window.renderTraitBars = function(container, traits) {
            container.innerHTML = '';
            Object.entries(traits).forEach(([trait, value]) => {
                const maxValue = trait.startsWith('big5_') ? 5 : 4;
                const percentage = (value / maxValue) * 100;
                
                const traitBar = document.createElement('div');
                traitBar.className = 'trait-bar';
                
                const label = document.createElement('div');
                label.className = 'trait-label';
                label.textContent = trait;
                
                const progress = document.createElement('div');
                progress.className = 'trait-progress';
                
                const fill = document.createElement('div');
                fill.className = 'trait-fill';
                fill.style.width = `${percentage}%`;
                
                const valueLabel = document.createElement('div');
                valueLabel.className = 'trait-value';
                valueLabel.textContent = value.toFixed(1);
                
                progress.appendChild(fill);
                traitBar.appendChild(label);
                traitBar.appendChild(progress);
                traitBar.appendChild(valueLabel);
                container.appendChild(traitBar);
            });
        };

        // æ ¹æ®è§’è‰²è·å–MBTIæè¿°
        function getMBTIDescription(type, role) {
            const descriptions = {
                child: {
                    'ESTJ': 'ä½ æ˜¯ä¸€ä¸ªè´Ÿè´£ä»»ã€å®é™…çš„äººï¼Œå–œæ¬¢æŒ‰è§„åˆ™åšäº‹ï¼Œæ“…é•¿ç»„ç»‡å’Œå¸¦é¢†å›¢é˜Ÿã€‚',
                    'ESTP': 'ä½ æ˜¯ä¸ªæ´»è·ƒã€å®é™…çš„é—®é¢˜è§£å†³è€…ï¼Œå–œæ¬¢å°è¯•æ–°äº‹ç‰©ï¼Œäº«å—å†’é™©å’ŒæŒ‘æˆ˜ã€‚',
                    'ESFJ': 'ä½ å‹å–„ã€ä¹äºåŠ©äººï¼Œé‡è§†å’Œè°å…³ç³»ï¼Œå–œæ¬¢ç…§é¡¾ä»–äººçš„éœ€è¦å’Œæ„Ÿå—ã€‚',
                    'ESFP': 'ä½ çƒ­æƒ…æ´»æ³¼ï¼Œå–œæ¬¢ä¸äººåˆ†äº«å¿«ä¹ï¼Œæ“…é•¿å‘ç°ç”Ÿæ´»ä¸­çš„ä¹è¶£å’Œç¾å¥½ã€‚',
                    'ENTJ': 'ä½ æ€ç»´æ•æ·ï¼Œæœ‰é¢†å¯¼æ‰èƒ½ï¼Œå–œæ¬¢åˆ¶å®šè®¡åˆ’å’Œç›®æ ‡ï¼Œè¿½æ±‚æ•ˆç‡å’Œæˆå°±ã€‚',
                    'ENTP': 'ä½ å……æ»¡åˆ›æ„å’Œå¥½å¥‡å¿ƒï¼Œå–œæ¬¢æ¢ç´¢å„ç§å¯èƒ½æ€§ï¼Œæ“…é•¿æ€è€ƒå’Œè¾©è®ºã€‚',
                    'ENFJ': 'ä½ å–„è§£äººæ„ï¼Œæœ‰æ„ŸæŸ“åŠ›ï¼Œå…³å¿ƒä»–äººæˆé•¿ï¼Œå–„äºé¼“åŠ±å’Œæ¿€åŠ±ä»–äººã€‚',
                    'ENFP': 'ä½ çƒ­æƒ…æ´‹æº¢ï¼Œå¯Œæœ‰æƒ³è±¡åŠ›ï¼Œå–œæ¬¢å°è¯•æ–°ç‚¹å­ï¼Œé‡è§†è‡ªç”±å’Œåˆ›æ–°ã€‚',
                    'ISTJ': 'ä½ è®¤çœŸè´Ÿè´£ï¼Œé‡è§†ç§©åºå’Œè§„åˆ™ï¼Œåšäº‹æœ‰æ¡ç†ï¼Œå€¼å¾—ä¿¡èµ–ã€‚',
                    'ISTP': 'ä½ å†·é™ã€çµæ´»ï¼Œå–„äºç”¨å·¥å…·è§£å†³é—®é¢˜ï¼Œå–œæ¬¢ç†è§£äº‹ç‰©å¦‚ä½•è¿ä½œã€‚',
                    'ISFJ': 'ä½ æ¸©å’Œã€ç»†å¿ƒï¼Œä¹äºå¸®åŠ©ä»–äººï¼Œé‡è§†ä¼ ç»Ÿå’Œç¨³å®šï¼Œéå¸¸å¯é ã€‚',
                    'ISFP': 'ä½ æ¸©å’Œã€æ•æ„Ÿï¼Œæ¬£èµç¾å¥½äº‹ç‰©ï¼Œå°Šé‡ä¸ªäººç©ºé—´ï¼Œåšäº‹æœ‰è‡ªå·±çš„èŠ‚å¥ã€‚',
                    'INTJ': 'ä½ æœ‰ç‹¬ç«‹æ€è€ƒèƒ½åŠ›ï¼Œå–„äºè§„åˆ’æœªæ¥ï¼Œè¿½æ±‚çŸ¥è¯†å’Œèƒ½åŠ›çš„æå‡ã€‚',
                    'INTP': 'ä½ æ€ç»´ç‹¬ç‰¹ï¼Œå–œæ¬¢åˆ†æå¤æ‚é—®é¢˜ï¼Œè¿½æ±‚é€»è¾‘å’Œç†è§£ï¼Œä¹äºæ¢ç´¢æ–°æ¦‚å¿µã€‚',
                    'INFJ': 'ä½ æœ‰æ´å¯ŸåŠ›ï¼Œç†æƒ³ä¸»ä¹‰ï¼Œå…³æ³¨ä»–äººå†…å¿ƒä¸–ç•Œï¼Œè¿½æ±‚æœ‰æ„ä¹‰çš„ç›®æ ‡ã€‚',
                    'INFP': 'ä½ å¯Œæœ‰åŒæƒ…å¿ƒï¼Œé‡è§†ä¸ªäººä»·å€¼è§‚ï¼Œæœ‰åˆ›æ„ï¼Œå…³æ³¨å†…å¿ƒå’Œç†æƒ³ã€‚'
                },
                parent: {
                    'ESTJ': 'æ‚¨æ³¨é‡è§„åˆ™å’Œç§©åºï¼Œæ•™è‚²å­©å­æ—¶æ¡ç†æ¸…æ™°ï¼Œæ³¨é‡åŸ¹å…»è´£ä»»æ„Ÿå’Œçºªå¾‹æ€§ã€‚',
                    'ESTP': 'æ‚¨çµæ´»åŠ¡å®ï¼Œé¼“åŠ±å­©å­åŠ¨æ‰‹å®è·µï¼Œå–„äºå¸®åŠ©å­©å­è§£å†³å®é™…é—®é¢˜ã€‚',
                    'ESFJ': 'æ‚¨å…³å¿ƒå­©å­çš„æƒ…æ„Ÿéœ€æ±‚ï¼Œé‡è§†å®¶åº­å’Œè°ï¼Œå–„äºåˆ›é€ æ¸©é¦¨çš„å®¶åº­ç¯å¢ƒã€‚',
                    'ESFP': 'æ‚¨æ´»æ³¼å¼€æœ—ï¼Œå–„äºä¸å­©å­ä¸€èµ·äº«å—ç”Ÿæ´»ä¹è¶£ï¼Œæ•™è‚²æ–¹å¼è½»æ¾æœ‰è¶£ã€‚',
                    'ENTJ': 'æ‚¨æœ‰è®¡åˆ’æ€§å’Œé¢†å¯¼åŠ›ï¼Œå¯¹å­©å­æœŸæœ›è¾ƒé«˜ï¼Œæ³¨é‡åŸ¹å…»ç›®æ ‡æ„Ÿå’Œæˆå°±æ„Ÿã€‚',
                    'ENTP': 'æ‚¨æ€ç»´çµæ´»ï¼Œé¼“åŠ±å­©å­æé—®å’Œæ¢ç´¢ï¼Œå–„äºæ¿€å‘å­©å­çš„åˆ›é€ åŠ›å’Œå¥½å¥‡å¿ƒã€‚',
                    'ENFJ': 'æ‚¨å–„äºç†è§£å’Œé¼“åŠ±å­©å­ï¼Œé‡è§†å­©å­çš„æˆé•¿å’Œå‘å±•ï¼Œæœ‰å¾ˆå¼ºçš„æ„ŸæŸ“åŠ›ã€‚',
                    'ENFP': 'æ‚¨çƒ­æƒ…ä¸”å¯Œæœ‰åˆ›æ„ï¼Œå°Šé‡å­©å­çš„ç‹¬ç‰¹æ€§ï¼Œæ•™è‚²æ–¹å¼çµæ´»å¤šå˜ã€‚',
                    'ISTJ': 'æ‚¨å¯é ä¸”æœ‰æ¡ç†ï¼Œæ³¨é‡ä¼ ç»Ÿä»·å€¼è§‚ï¼Œæ•™è‚²æ–¹å¼ä¸€è‡´ä¸”æœ‰è§„å¾‹ã€‚',
                    'ISTP': 'æ‚¨å†·é™ä¸”å®é™…ï¼Œå°Šé‡å­©å­çš„ç‹¬ç«‹æ€§ï¼Œå–„äºæ•™å¯¼è§£å†³é—®é¢˜çš„æŠ€èƒ½ã€‚',
                    'ISFJ': 'æ‚¨ç»†å¿ƒä¸”æœ‰è€å¿ƒï¼Œå…³æ³¨å­©å­çš„æ—¥å¸¸éœ€æ±‚ï¼Œåˆ›é€ ç¨³å®šå®‰å…¨çš„å®¶åº­ç¯å¢ƒã€‚',
                    'ISFP': 'æ‚¨æ¸©å’Œä¸”çµæ´»ï¼Œå°Šé‡å­©å­çš„æ„Ÿå—ï¼Œä¸å¼ºæ±‚ï¼Œç»™äºˆå­©å­æˆé•¿çš„ç©ºé—´ã€‚',
                    'INTJ': 'æ‚¨æœ‰è¿œè§å’Œç‹¬ç«‹æ€è€ƒèƒ½åŠ›ï¼Œæ³¨é‡åŸ¹å…»å­©å­çš„é€»è¾‘æ€ç»´å’Œè§„åˆ’èƒ½åŠ›ã€‚',
                    'INTP': 'æ‚¨æ€ç»´æ·±å…¥ï¼Œé¼“åŠ±å­©å­ç‹¬ç«‹æ€è€ƒï¼Œé‡è§†çŸ¥è¯†å’Œç†è§£åŠ›çš„åŸ¹å…»ã€‚',
                    'INFJ': 'æ‚¨æœ‰ç†æƒ³ä¸»ä¹‰å€¾å‘ï¼Œå…³æ³¨å­©å­çš„å†…å¿ƒä¸–ç•Œï¼Œè¿½æ±‚æœ‰æ„ä¹‰çš„æ•™è‚²æ–¹å¼ã€‚',
                    'INFP': 'æ‚¨å°Šé‡å­©å­çš„ä¸ªæ€§å’Œä»·å€¼è§‚ï¼Œæ•™è‚²æ–¹å¼æ¸©å’Œï¼Œå…³æ³¨å­©å­çš„æƒ…æ„Ÿå‘å±•ã€‚'
                }
            };
            
            return descriptions[role][type] || 'æ— æ³•è·å–è¯¦ç»†æè¿°';
        }

        // æ ¹æ®è§’è‰²è·å–DISCæè¿°
        function getDISCDescription(discResult, role) {
            // æ‰¾å‡ºä¸»å¯¼ç‰¹è´¨
            let dominantTrait = '';
            let maxScore = 0;
            
            for (const [trait, score] of Object.entries(discResult)) {
                if (score > maxScore) {
                    maxScore = score;
                    dominantTrait = trait;
                }
            }
            
            const descriptions = {
                child: {
                    'D': 'ä½ æœ‰å¾ˆå¼ºçš„è‡ªä¸»æ€§å’Œå†³æ–­åŠ›ï¼Œå–œæ¬¢æŒæ§å±€é¢ï¼Œæœ‰é¢†å¯¼æ‰èƒ½ï¼Œä½†æœ‰æ—¶å¯èƒ½æ˜¾å¾—æœ‰äº›å¼ºåŠ¿ã€‚',
                    'I': 'ä½ æ´»æ³¼å¼€æœ—ï¼Œå–„äºäº¤é™…ï¼Œèƒ½å¤Ÿæ„ŸæŸ“å‘¨å›´çš„äººï¼Œå–œæ¬¢æˆä¸ºç„¦ç‚¹ï¼Œä½†æœ‰æ—¶å¯èƒ½ä¸å¤Ÿä¸“æ³¨ã€‚',
                    'S': 'ä½ æ¸©å’Œç¨³å®šï¼Œæœ‰è€å¿ƒï¼Œé‡è§†å’Œè°å…³ç³»ï¼Œå¯é ä¸”å¿ è¯šï¼Œä½†æœ‰æ—¶å¯èƒ½ä¸å¤ªå–œæ¬¢å˜åŒ–ã€‚',
                    'C': 'ä½ åšäº‹è®¤çœŸä»”ç»†ï¼Œæ³¨é‡è´¨é‡å’Œå‡†ç¡®æ€§ï¼Œæœ‰æ¡ç†ï¼Œä½†æœ‰æ—¶å¯èƒ½è¿‡äºè¿½æ±‚å®Œç¾ã€‚'
                },
                parent: {
                    'D': 'æ‚¨çš„æ•™è‚²é£æ ¼æœæ–­ç›´æ¥ï¼Œè®¾å®šæ˜ç¡®ç›®æ ‡ï¼Œè¿½æ±‚é«˜æ•ˆç‡ï¼Œä½†éœ€è¦æ³¨æ„å€¾å¬å­©å­çš„æƒ³æ³•ã€‚',
                    'I': 'æ‚¨çš„æ•™è‚²é£æ ¼çƒ­æƒ…æ´»æ³¼ï¼Œå–„äºé¼“åŠ±å’Œè¡¨æ‰¬ï¼Œè¥é€ ç§¯ææ°›å›´ï¼Œä½†éœ€è¦ä¿æŒä¸€è‡´æ€§ã€‚',
                    'S': 'æ‚¨çš„æ•™è‚²é£æ ¼æ¸©å’Œè€å¿ƒï¼Œæä¾›ç¨³å®šæ”¯æŒï¼Œé‡è§†å®¶åº­å’Œè°ï¼Œä½†å¯ä»¥é€‚å½“å¢åŠ æ–°å°è¯•ã€‚',
                    'C': 'æ‚¨çš„æ•™è‚²é£æ ¼æ³¨é‡ç»†èŠ‚å’Œè§„åˆ™ï¼Œæœ‰è®¡åˆ’å’Œæ¡ç†ï¼Œä½†å¯ä»¥é€‚å½“æ”¾æ¾å¯¹å®Œç¾çš„è¿½æ±‚ã€‚'
                }
            };
            
            return descriptions[role][dominantTrait] || 'æ— æ³•è·å–è¯¦ç»†æè¿°';
        }

        // æ ¹æ®è§’è‰²è·å–å¤§äº”äººæ ¼æè¿°
        function getBig5Description(bigFiveResult, role) {
            let highTraits = [];
            const threshold = role === 'child' ? 3 : 3; // è®¾ç½®é˜ˆå€¼
            
            for (const [trait, score] of Object.entries(bigFiveResult)) {
                if (score > threshold) {
                    highTraits.push(trait);
                }
            }
            
            if (highTraits.length === 0) {
                return role === 'child' 
                    ? 'ä½ çš„æ€§æ ¼ç‰¹è´¨æ¯”è¾ƒå‡è¡¡ï¼Œæ²¡æœ‰ç‰¹åˆ«çªå‡ºçš„æ–¹é¢ã€‚' 
                    : 'æ‚¨çš„æ€§æ ¼ç‰¹è´¨æ¯”è¾ƒå‡è¡¡ï¼Œæ²¡æœ‰ç‰¹åˆ«çªå‡ºçš„æ–¹é¢ã€‚';
            }
            
            const descriptions = {
                child: {
                    'å¤–å‘æ€§': 'ä½ ä¹äºç¤¾äº¤ï¼Œå–œæ¬¢ä¸äººäº¤æµï¼Œæœ‰æ´»åŠ›å’Œçƒ­æƒ…ã€‚',
                    'å®œäººæ€§': 'ä½ å¯Œæœ‰åŒæƒ…å¿ƒï¼Œå…³å¿ƒä»–äººæ„Ÿå—ï¼Œæ„¿æ„å¸®åŠ©åˆ«äººã€‚',
                    'å°½è´£æ€§': 'ä½ æœ‰æ¡ç†ï¼Œåšäº‹è®¤çœŸè´Ÿè´£ï¼Œèƒ½å¤ŸåšæŒå®Œæˆä»»åŠ¡ã€‚',
                    'æƒ…ç»ªç¨³å®šæ€§': 'ä½ èƒ½å¤Ÿå¾ˆå¥½åœ°æ§åˆ¶æƒ…ç»ªï¼Œé¢å¯¹å‹åŠ›æ—¶ä¿æŒå†·é™ã€‚',
                    'å¼€æ”¾æ€§': 'ä½ å¥½å¥‡å¿ƒå¼ºï¼Œå–œæ¬¢å°è¯•æ–°äº‹ç‰©ï¼Œæ€ç»´çµæ´»æœ‰åˆ›æ„ã€‚'
                },
                parent: {
                    'å¤–å‘æ€§': 'æ‚¨ä¹äºç¤¾äº¤äº’åŠ¨ï¼Œæ•™è‚²æ–¹å¼æ´»è·ƒå¼€æ”¾ï¼Œå–„äºå»ºç«‹å¹¿æ³›çš„ç¤¾äº¤ç½‘ç»œã€‚',
                    'å®œäººæ€§': 'æ‚¨å¯Œæœ‰åŒç†å¿ƒï¼Œå°Šé‡å­©å­çš„æ„Ÿå—ï¼Œåˆ›é€ æ¸©æš–å’Œè°çš„å®¶åº­æ°›å›´ã€‚',
                    'å°½è´£æ€§': 'æ‚¨æ•™è‚²æ–¹å¼æœ‰æ¡ç†å’Œè®¡åˆ’æ€§ï¼Œæ³¨é‡åŸ¹å…»å­©å­çš„è´£ä»»æ„Ÿå’Œè‡ªå¾‹èƒ½åŠ›ã€‚',
                    'æƒ…ç»ªç¨³å®šæ€§': 'æ‚¨èƒ½å¤Ÿç†æ€§åº”å¯¹è‚²å„¿å‹åŠ›ï¼Œæƒ…ç»ªç¨³å®šï¼Œä¸ºå­©å­æ ‘ç«‹è‰¯å¥½æ¦œæ ·ã€‚',
                    'å¼€æ”¾æ€§': 'æ‚¨æ€ç»´å¼€æ”¾ï¼Œé¼“åŠ±å­©å­æ¢ç´¢å’Œåˆ›æ–°ï¼Œæ¥çº³å¤šå…ƒåŒ–çš„è§‚ç‚¹å’Œä½“éªŒã€‚'
                }
            };
            
            let result = role === 'child' ? 'ä½ çš„çªå‡ºç‰¹è´¨ï¼š' : 'æ‚¨çš„çªå‡ºç‰¹è´¨ï¼š';
            highTraits.forEach((trait, index) => {
                result += descriptions[role][trait];
                if (index < highTraits.length - 1) {
                    result += ' ';
                }
            });
            
            return result;
        }

        // ç”Ÿæˆæ²Ÿé€šå»ºè®®
        function generateCommunicationTips(role, mbtiResult, discResult, bigFiveResult) {
            const communicationTipsElem = document.getElementById('communicationTips');
            
            let tips = '<h3>' + (role === 'child' ? 'ä¸å®¶é•¿æ²Ÿé€šå»ºè®®' : 'ä¸å­©å­æ²Ÿé€šå»ºè®®') + '</h3><ul>';
            
            // åŸºäºMBTIçš„å»ºè®®
            const mbtiType = mbtiResult.E_I + mbtiResult.S_N + mbtiResult.T_F + mbtiResult.J_P;
            if (role === 'child') {
                if (mbtiResult.E_I === 'I') {
                    tips += '<li>ä½ å¯èƒ½éœ€è¦æ›´å¤šçš„ç‹¬å¤„æ—¶é—´ï¼Œåœ¨ä¸å®¶é•¿äº¤æµå‰å…ˆæ•´ç†å¥½è‡ªå·±çš„æƒ³æ³•ã€‚</li>';
                } else {
                    tips += '<li>ä½ å–œæ¬¢é€šè¿‡äº¤æµè¡¨è¾¾è‡ªå·±ï¼Œå¯ä»¥ä¸»åŠ¨ä¸å®¶é•¿åˆ†äº«ä½ çš„æƒ³æ³•å’Œæ„Ÿå—ã€‚</li>';
                }
                
                if (mbtiResult.T_F === 'T') {
                    tips += '<li>åœ¨è®¨è®ºé—®é¢˜æ—¶ï¼Œå°è¯•è€ƒè™‘å®¶é•¿çš„æ„Ÿå—ï¼Œè€Œä¸ä»…ä»…å…³æ³¨äº‹å®å’Œé€»è¾‘ã€‚</li>';
                } else {
                    tips += '<li>å½“ä½ å› ä¸ºæƒ…æ„Ÿå› ç´ åšå†³å®šæ—¶ï¼Œå¯ä»¥å°è¯•å‘å®¶é•¿è§£é‡Šä½ çš„æ„Ÿå—ã€‚</li>';
                }
            } else {
                if (mbtiResult.E_I === 'I') {
                    tips += '<li>ç»™å­©å­ä¸€äº›æ€è€ƒå’Œç‹¬å¤„çš„ç©ºé—´ï¼Œä¸è¦æ€»æ˜¯æœŸæœ›å³æ—¶çš„åé¦ˆã€‚</li>';
                } else {
                    tips += '<li>å¤šåˆ›é€ äº¤æµçš„æœºä¼šï¼Œæ”¯æŒå­©å­é€šè¿‡è®¨è®ºæ¥ç†æ¸…æ€è·¯ã€‚</li>';
                }
                
                if (mbtiResult.T_F === 'T') {
                    tips += '<li>åœ¨ä¸å­©å­äº¤æµæ—¶ï¼Œä¸ä»…è¦å…³æ³¨é€»è¾‘å’Œäº‹å®ï¼Œè¿˜è¦å…³æ³¨æƒ…æ„Ÿå› ç´ ã€‚</li>';
                } else {
                    tips += '<li>é‡è§†å­©å­çš„æƒ…æ„Ÿè¡¨è¾¾ï¼Œå³ä½¿æœ‰æ—¶çœ‹èµ·æ¥ä¸å¤Ÿç†æ€§ã€‚</li>';
                }
            }
            
            // åŸºäºDISCçš„å»ºè®®
            let dominantDisc = '';
            let maxScore = 0;
            for (const [trait, score] of Object.entries(discResult)) {
                if (score > maxScore) {
                    maxScore = score;
                    dominantDisc = trait;
                }
            }
            
            if (role === 'child') {
                if (dominantDisc === 'D') {
                    tips += '<li>åœ¨è¡¨è¾¾è‡ªå·±çš„è§‚ç‚¹æ—¶ï¼Œç»™å®¶é•¿ç•™å‡ºè¡¨è¾¾æ„è§çš„ç©ºé—´ã€‚</li>';
                } else if (dominantDisc === 'I') {
                    tips += '<li>ä¸å®¶é•¿è®¨è®ºé‡è¦äº‹é¡¹æ—¶ï¼Œå°è¯•æ›´æœ‰æ¡ç†åœ°è¡¨è¾¾ï¼Œå…³æ³¨ç»†èŠ‚ã€‚</li>';
                } else if (dominantDisc === 'S') {
                    tips += '<li>å½“ä½ å¯¹å®¶é•¿çš„å»ºè®®æœ‰ä¸åŒæƒ³æ³•æ—¶ï¼Œå¯ä»¥æ›´ç›´æ¥åœ°è¡¨è¾¾å‡ºæ¥ã€‚</li>';
                } else if (dominantDisc === 'C') {
                    tips += '<li>ä¸å®¶é•¿äº¤æµæ—¶ï¼Œä¸å¿…å¯¹æ¯ä¸ªç»†èŠ‚éƒ½è¿‡åˆ†å…³æ³¨ï¼Œæœ‰æ—¶éœ€è¦çœ‹å¤§å±€ã€‚</li>';
                }
            } else {
                if (dominantDisc === 'D') {
                    tips += '<li>æ”¾æ…¢èŠ‚å¥ï¼Œç»™å­©å­å……åˆ†è¡¨è¾¾çš„æ—¶é—´ï¼Œé¿å…è¿‡äºæŒ‡ä»¤æ€§çš„æ²Ÿé€šã€‚</li>';
                } else if (dominantDisc === 'I') {
                    tips += '<li>ä¸å­©å­äº¤æµæ—¶ï¼Œç¡®ä¿ä¼ è¾¾æ˜ç¡®çš„ä¿¡æ¯ï¼Œè€Œä¸ä»…ä»…æ˜¯çƒ­æƒ…çš„è¡¨è¾¾ã€‚</li>';
                } else if (dominantDisc === 'S') {
                    tips += '<li>é¼“åŠ±å­©å­è¡¨è¾¾è‡ªå·±çš„æƒ³æ³•ï¼Œä¸»åŠ¨è¯¢é—®è€Œä¸ä»…ä»…ç­‰å¾…ä»–ä»¬å¼€å£ã€‚</li>';
                } else if (dominantDisc === 'C') {
                    tips += '<li>ä¸å­©å­äº¤æµæ—¶ï¼Œä¸å¿…è¿‡åˆ†å¼ºè°ƒç»†èŠ‚å’Œå®Œç¾ï¼Œå¤šå…³æ³¨æƒ…æ„Ÿè¿æ¥ã€‚</li>';
                }
            }
            
            tips += '</ul>';
            communicationTipsElem.innerHTML = tips;
        }
    </script>
</body>
</html> 